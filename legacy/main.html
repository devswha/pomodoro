<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ë©”ì¸ í˜ì´ì§€ - Stepper</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="main-style.css?v=20250813-102700">
    <script src="user-manager.js"></script>
</head>
<body>
    <div class="iphone-container">

        <!-- User Header -->
        <div class="user-header">
            <div class="user-info">
                <div class="user-avatar">
                    <span class="user-initial" id="userInitial">U</span>
                </div>
                <div class="user-details">
                    <span class="user-name" id="userName">ì‚¬ìš©ì</span>
                    <span class="user-welcome">ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹</span>
                </div>
            </div>
            <button class="logout-btn" id="logoutBtn">
                <span>ë¡œê·¸ì•„ì›ƒ</span>
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Statistics Cards -->
            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-header">
                        <h3 class="stat-title">í•™ìŠµ í†µê³„</h3>
                        <button class="stat-link" id="studyStatsBtn">ìì„¸íˆ></button>
                    </div>
                    <div class="chart-container">
                        <div class="progress-chart" id="studyChart">
                            <svg width="120" height="120" viewBox="0 0 120 120">
                                <circle 
                                    cx="60" cy="60" r="45" 
                                    fill="none" 
                                    stroke="#F0F0F0" 
                                    stroke-width="10"
                                />
                                <!-- Purple segment -->
                                <circle 
                                    cx="60" cy="60" r="45" 
                                    fill="none" 
                                    stroke="#6B46C1" 
                                    stroke-width="10" 
                                    stroke-linecap="round"
                                    stroke-dasharray="141.37"
                                    stroke-dashoffset="70.68"
                                    transform="rotate(-90 60 60)"
                                    class="progress-segment progress-purple"
                                />
                                <!-- Orange segment -->
                                <circle 
                                    cx="60" cy="60" r="45" 
                                    fill="none" 
                                    stroke="#F97316" 
                                    stroke-width="10" 
                                    stroke-linecap="round"
                                    stroke-dasharray="94.25"
                                    stroke-dashoffset="0"
                                    transform="rotate(90 60 60)"
                                    class="progress-segment progress-orange"
                                />
                            </svg>
                            <div class="chart-center">
                                <div class="chart-value">75%</div>
                                <div class="chart-label">ì™„ë£Œ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <h3 class="stat-title">ì›”ë³„ ê¸°ë¡</h3>
                        <button class="stat-link" id="monthlyStatsBtn">ìì„¸íˆ></button>
                    </div>
                    <div class="chart-placeholder">
                        <span class="placeholder-text"><ë‹¬ë ¥ ì´ë¯¸ì§€></span>
                    </div>
                </div>
            </div>

            <!-- Action Cards -->
            <div class="actions-section">
                <div class="action-card" id="pomodoroStartCard">
                    <h3 class="action-title">ë½€ëª¨ë„ë¡œ ì‹œì‘í•˜ê¸°</h3>
                    <div class="action-description">ì§‘ì¤‘ë ¥ í–¥ìƒì„ ìœ„í•œ ì‹œê°„ ê´€ë¦¬ ê¸°ë²•</div>
                </div>

                <div class="action-card" id="pomodoroRankingCard">
                    <h3 class="action-title">ë½€ëª¨ë„ë¡œ ë­í‚¹</h3>
                    <div class="action-description">ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ê³¼ ë¹„êµí•´ë³´ì„¸ìš”</div>
                </div>

                <div class="action-card" id="eventCard">
                    <h3 class="action-title">ì§„í–‰ì¤‘ì¸ ì´ë²¤íŠ¸</h3>
                    <div class="action-description">íŠ¹ë³„í•œ í˜œíƒê³¼ ë„ì „ ê³¼ì œ</div>
                </div>
            </div>

            <!-- Today's Pomodoro -->
            <div class="today-section">
                <h2 class="today-title">ì§„í–‰ì¤‘ì¸ ë½€ëª¨ë„ë¡œ</h2>
                <div class="today-pomodoro" id="activePomodoroSection">
                    <div class="no-active-session" id="noActiveSession">
                        <div class="no-session-text">ì§„í–‰ì¤‘ì¸ ë½€ëª¨ë„ë¡œê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="no-session-subtitle">ë½€ëª¨ë„ë¡œë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!</div>
                    </div>
                    <div class="active-session" id="activeSessionDisplay" style="display: none;">
                        <div class="session-info">
                            <div class="session-title" id="sessionTitle">ë½€ëª¨ë„ë¡œ ì„¸ì…˜</div>
                            <div class="session-goal" id="sessionGoal">ëª©í‘œë¥¼ ë‹¬ì„±í•´ë³´ì„¸ìš”</div>
                        </div>
                        <div class="pomodoro-timer">
                            <div class="timer-display" id="timerDisplay">25:00</div>
                            <div class="timer-progress">
                                <div class="progress-bar" id="progressBar"></div>
                            </div>
                        </div>
                        <div class="pomodoro-actions">
                            <button class="pomodoro-btn pause" id="pauseBtn">ì¼ì‹œì •ì§€</button>
                            <button class="pomodoro-btn stop" id="stopBtn">ì¢…ë£Œ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ MainDashboard ì§ì ‘ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ DOM ë¡œë“œ ì™„ë£Œ! ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘...');
            
            // MainDashboard í´ë˜ìŠ¤ ì •ì˜
            class MainDashboard {
                constructor() {
                    console.log('ğŸš€ ì¸ë¼ì¸ MainDashboard ì´ˆê¸°í™” ì‹œì‘...');
                    this.currentUser = null;
                    this.pomodoroTimer = null;
                    this.isTimerRunning = false;
                    this.timeRemaining = 25 * 60;
                    this.activeSession = null;
                    this.isPaused = false;
                    this.init();
                }
                
                async init() {
                    try {
                        console.log('1ï¸âƒ£ ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì¤‘...');
                        this.loadUserData();
                        
                        console.log('2ï¸âƒ£ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì¤‘...');
                        this.setupEventListeners();
                        
                        console.log('3ï¸âƒ£ UI ì—…ë°ì´íŠ¸ ì¤‘...');
                        this.updateUI();
                        
                        console.log('3.5ï¸âƒ£ í™œì„± ë½€ëª¨ë„ë¡œ ì„¸ì…˜ ì²´í¬ ì¤‘...');
                        this.checkActiveSession();
                        
                        console.log('4ï¸âƒ£ íƒ€ì´ë¨¸ ì‹œì‘ ì¤‘...');
                        this.startTimeDisplay();
                        
                        console.log('ğŸ‰ MainDashboard ì´ˆê¸°í™” ì™„ë£Œ!');
                    } catch (error) {
                        console.error('ğŸ’¥ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
                        alert('í˜ì´ì§€ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    }
                }
                
                loadUserData() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const userId = urlParams.get('user') || localStorage.getItem('currentUser') || 'ì‚¬ìš©ì';
                    console.log('ğŸ” URL íŒŒë¼ë¯¸í„°:', urlParams.toString());
                    console.log('ğŸ‘¤ ì‚¬ìš©ì ID:', userId);
                    
                    // ì‚¬ìš©ì ë§¤ë‹ˆì €ë¥¼ í†µí•´ ë¡œê·¸ì¸ (ìë™ ë“±ë¡ í¬í•¨)
                    this.currentUser = window.userManager.loginUser(userId);
                    
                    localStorage.setItem('currentUser', userId);
                    console.log('âœ… ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', this.currentUser.id);
                }
                
                setupEventListeners() {
                    console.log('ğŸ”— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹œì‘...');
                    
                    const addSafeListener = (selector, event, handler, description) => {
                        const element = document.querySelector(selector);
                        if (element) {
                            element.addEventListener(event, handler);
                            console.log(`âœ… ${description} ì—°ê²°ë¨`);
                            return true;
                        } else {
                            console.warn(`âš ï¸ ${description} ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${selector}`);
                            return false;
                        }
                    };
                    
                    let connected = 0;
                    connected += addSafeListener('#logoutBtn', 'click', () => this.handleLogout(), 'ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼') ? 1 : 0;
                    connected += addSafeListener('#studyStatsBtn', 'click', () => this.handleStudyStats(), 'í•™ìŠµ í†µê³„ ë²„íŠ¼') ? 1 : 0;
                    connected += addSafeListener('#monthlyStatsBtn', 'click', () => this.handleMonthlyStats(), 'ì›”ë³„ ê¸°ë¡ ë²„íŠ¼') ? 1 : 0;
                    connected += addSafeListener('#pomodoroStartCard', 'click', () => this.handlePomodoroStart(), 'ë½€ëª¨ë„ë¡œ ì‹œì‘ ì¹´ë“œ') ? 1 : 0;
                    connected += addSafeListener('#pomodoroRankingCard', 'click', () => this.handlePomodoroRanking(), 'ë½€ëª¨ë„ë¡œ ë­í‚¹ ì¹´ë“œ') ? 1 : 0;
                    connected += addSafeListener('#eventCard', 'click', () => this.handleEvent(), 'ì´ë²¤íŠ¸ ì¹´ë“œ') ? 1 : 0;
                    connected += addSafeListener('#breakBtn', 'click', () => this.handleBreak(), 'ì¤‘ë‹¨ ë²„íŠ¼') ? 1 : 0;
                    connected += addSafeListener('#focusBtn', 'click', () => this.handleFocus(), 'ì¢…ë£Œ ë²„íŠ¼') ? 1 : 0;
                    connected += addSafeListener('#pauseBtn', 'click', () => this.pausePomodoroSession(), 'ì¼ì‹œì •ì§€ ë²„íŠ¼') ? 1 : 0;
                    connected += addSafeListener('#stopBtn', 'click', () => this.stopPomodoroSession(), 'ì„¸ì…˜ ì¢…ë£Œ ë²„íŠ¼') ? 1 : 0;
                    
                    console.log(`ğŸ“Š ì´ ${connected}/10ê°œ ë²„íŠ¼ ì—°ê²° ì™„ë£Œ`);
                    
                    if (connected === 0) {
                        throw new Error('ëª¨ë“  ë²„íŠ¼ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                }
                
                updateUI() {
                    const userName = document.querySelector('#userName');
                    const userInitial = document.querySelector('#userInitial');
                    
                    if (userName && userInitial && this.currentUser) {
                        userName.textContent = this.currentUser.id;
                        userInitial.textContent = this.currentUser.id.charAt(0).toUpperCase();
                        
                        console.log('âœ¨ UI ì—…ë°ì´íŠ¸: ì´ë¦„=' + this.currentUser.id + ', ì´ˆê¸°=' + this.currentUser.id.charAt(0).toUpperCase());
                        
                        const colors = [
                            'linear-gradient(135deg, #007AFF, #5856D6)',
                            'linear-gradient(135deg, #34C759, #32D74B)', 
                            'linear-gradient(135deg, #FF9500, #FF6B00)',
                            'linear-gradient(135deg, #FF3B30, #D70015)',
                            'linear-gradient(135deg, #5856D6, #AF52DE)',
                            'linear-gradient(135deg, #00C7BE, #5856D6)'
                        ];
                        
                        const colorIndex = this.currentUser.id.length % colors.length;
                        const avatar = userInitial.parentElement;
                        if (avatar) {
                            avatar.style.background = colors[colorIndex];
                        }
                        
                        console.log('âœ… ì‚¬ìš©ì UI ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    }
                }
                
                startTimeDisplay() {
                    const pomodoroTime = document.querySelector('#pomodoroTime');
                    if (!pomodoroTime) return;
                    
                    const updateTime = () => {
                        const now = new Date();
                        const timeString = now.toLocaleTimeString('ko-KR', {
                            hour: '2-digit',
                            minute: '2-digit',
                            hour12: true
                        });
                        pomodoroTime.textContent = timeString;
                    };
                    
                    updateTime();
                    setInterval(updateTime, 1000);
                    console.log('â° ì‹œê³„ í‘œì‹œ ì‹œì‘');
                }
                
                handleLogout() {
                    console.log('ğŸšª ë¡œê·¸ì•„ì›ƒ í´ë¦­ë¨');
                    const confirmed = confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                    if (confirmed) {
                        localStorage.removeItem('currentUser');
                        localStorage.removeItem('userStats');
                        this.showToast('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 1000);
                    }
                }
                
                handleStudyStats() {
                    console.log('ğŸ“Š í•™ìŠµ í†µê³„ í´ë¦­ë¨');
                    this.showToast('í•™ìŠµ í†µê³„ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤');
                    setTimeout(() => {
                        window.location.href = `mypage.html?user=${encodeURIComponent(this.currentUser.id)}`;
                    }, 500);
                }
                
                handleMonthlyStats() {
                    console.log('ğŸ“… ì›”ë³„ ê¸°ë¡ í´ë¦­ë¨');
                    this.showToast('ì›”ë³„ ê¸°ë¡ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤');
                    setTimeout(() => {
                        window.location.href = `monthly.html?user=${encodeURIComponent(this.currentUser.id)}`;
                    }, 500);
                }
                
                handlePomodoroStart() {
                    console.log('ğŸ… ë½€ëª¨ë„ë¡œ ì‹œì‘ í´ë¦­ë¨');
                    this.showToast('ë½€ëª¨ë„ë¡œ ì‹œì‘ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤');
                    setTimeout(() => {
                        window.location.href = `pomodoro-start.html?user=${encodeURIComponent(this.currentUser.id)}`;
                    }, 500);
                }
                
                handlePomodoroRanking() {
                    console.log('ğŸ† ë½€ëª¨ë„ë¡œ ë­í‚¹ í´ë¦­ë¨');
                    this.showToast('ë½€ëª¨ë„ë¡œ ë­í‚¹ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤');
                    setTimeout(() => {
                        window.location.href = `pomodoro-ranking.html?user=${encodeURIComponent(this.currentUser.id)}`;
                    }, 500);
                }
                
                handleEvent() {
                    console.log('ğŸ‰ ì´ë²¤íŠ¸ í´ë¦­ë¨');
                    this.showToast('ì§„í–‰ì¤‘ì¸ ì´ë²¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤');
                }
                
                handleBreak() {
                    console.log('â¸ï¸ ì¤‘ë‹¨ ë²„íŠ¼ í´ë¦­ë¨');
                    this.showToast('ì¤‘ë‹¨ ê¸°ëŠ¥');
                }
                
                handleFocus() {
                    console.log('â¹ï¸ ì¢…ë£Œ ë²„íŠ¼ í´ë¦­ë¨');
                    this.showToast('ì¢…ë£Œ ê¸°ëŠ¥');
                }
                
                checkActiveSession() {
                    const activeSessionKey = `activePomodoroSession_${this.currentUser.id}`;
                    const activeSessionData = localStorage.getItem(activeSessionKey);
                    if (activeSessionData) {
                        try {
                            this.activeSession = JSON.parse(activeSessionData);
                            const now = new Date();
                            const endTime = new Date(this.activeSession.endTime);
                            
                            // Check if session is still active
                            if (now < endTime) {
                                console.log('ğŸ… í™œì„± ë½€ëª¨ë„ë¡œ ì„¸ì…˜ ë°œê²¬:', this.activeSession);
                                this.displayActiveSession();
                                this.startPomodoroTimer();
                            } else {
                                console.log('â° ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤');
                                localStorage.removeItem(activeSessionKey);
                                this.showNoActiveSession();
                            }
                        } catch (error) {
                            console.error('ì„¸ì…˜ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', error);
                            localStorage.removeItem(activeSessionKey);
                            this.showNoActiveSession();
                        }
                    } else {
                        console.log('ğŸ“­ í™œì„± ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤');
                        this.showNoActiveSession();
                    }
                }

                displayActiveSession() {
                    const noSessionDiv = document.getElementById('noActiveSession');
                    const activeSessionDiv = document.getElementById('activeSessionDisplay');
                    const sessionTitle = document.getElementById('sessionTitle');
                    const sessionGoal = document.getElementById('sessionGoal');
                    
                    if (noSessionDiv) noSessionDiv.style.display = 'none';
                    if (activeSessionDiv) activeSessionDiv.style.display = 'block';
                    if (sessionTitle) sessionTitle.textContent = this.activeSession.title;
                    if (sessionGoal) sessionGoal.textContent = this.activeSession.goal || 'ì§‘ì¤‘í•´ì„œ ëª©í‘œë¥¼ ë‹¬ì„±í•´ë³´ì„¸ìš”!';
                }

                showNoActiveSession() {
                    const noSessionDiv = document.getElementById('noActiveSession');
                    const activeSessionDiv = document.getElementById('activeSessionDisplay');
                    
                    if (noSessionDiv) noSessionDiv.style.display = 'block';
                    if (activeSessionDiv) activeSessionDiv.style.display = 'none';
                }

                startPomodoroTimer() {
                    if (this.pomodoroTimer) {
                        clearInterval(this.pomodoroTimer);
                    }
                    
                    const now = new Date();
                    const startTime = new Date(this.activeSession.startTime);
                    const endTime = new Date(this.activeSession.endTime);
                    const totalDuration = endTime - startTime;
                    const elapsed = now - startTime;
                    
                    this.timeRemaining = Math.max(0, Math.floor((endTime - now) / 1000));
                    
                    console.log(`â±ï¸ ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸ ì‹œì‘: ${Math.floor(this.timeRemaining / 60)}:${(this.timeRemaining % 60).toString().padStart(2, '0')}`);
                    
                    this.pomodoroTimer = setInterval(() => {
                        if (!this.isPaused && this.timeRemaining > 0) {
                            this.timeRemaining--;
                            this.updateTimerDisplay();
                            this.updateProgressBar(elapsed, totalDuration);
                        } else if (this.timeRemaining <= 0) {
                            this.completePomodoroSession();
                        }
                    }, 1000);
                    
                    this.updateTimerDisplay();
                    this.updateProgressBar(elapsed, totalDuration);
                }

                updateTimerDisplay() {
                    const timerDisplay = document.getElementById('timerDisplay');
                    if (timerDisplay) {
                        const minutes = Math.floor(this.timeRemaining / 60);
                        const seconds = this.timeRemaining % 60;
                        timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    }
                }

                updateProgressBar(elapsed, totalDuration) {
                    const progressBar = document.getElementById('progressBar');
                    if (progressBar) {
                        const progress = Math.min(100, (elapsed / totalDuration) * 100);
                        progressBar.style.width = `${progress}%`;
                    }
                }

                completePomodoroSession() {
                    console.log('ğŸ‰ ë½€ëª¨ë„ë¡œ ì„¸ì…˜ ì™„ë£Œ!');
                    clearInterval(this.pomodoroTimer);
                    const activeSessionKey = `activePomodoroSession_${this.currentUser.id}`;
                    localStorage.removeItem(activeSessionKey);
                    this.showToast('ë½€ëª¨ë„ë¡œ ì„¸ì…˜ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    this.showNoActiveSession();
                    
                    // Update completed sessions history
                    this.activeSession.status = 'completed';
                    this.activeSession.completedAt = new Date().toISOString();
                    
                    const userSessionsKey = `pomodoroSessions_${this.currentUser.id}`;
                    const sessions = JSON.parse(localStorage.getItem(userSessionsKey) || '[]');
                    const sessionIndex = sessions.findIndex(s => s.id === this.activeSession.id);
                    if (sessionIndex >= 0) {
                        sessions[sessionIndex] = this.activeSession;
                        localStorage.setItem(userSessionsKey, JSON.stringify(sessions));
                    }
                    
                    // Update user statistics for completion
                    this.updateUserStatsForCompletion(this.activeSession);
                }

                pausePomodoroSession() {
                    this.isPaused = !this.isPaused;
                    const pauseBtn = document.getElementById('pauseBtn');
                    if (pauseBtn) {
                        pauseBtn.textContent = this.isPaused ? 'ê³„ì†' : 'ì¼ì‹œì •ì§€';
                    }
                    console.log(this.isPaused ? 'â¸ï¸ íƒ€ì´ë¨¸ ì¼ì‹œì •ì§€' : 'â–¶ï¸ íƒ€ì´ë¨¸ ì¬ì‹œì‘');
                }

                stopPomodoroSession() {
                    const confirmed = confirm('ì •ë§ë¡œ ë½€ëª¨ë„ë¡œ ì„¸ì…˜ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                    if (confirmed) {
                        clearInterval(this.pomodoroTimer);
                        const activeSessionKey = `activePomodoroSession_${this.currentUser.id}`;
                        localStorage.removeItem(activeSessionKey);
                        this.showToast('ë½€ëª¨ë„ë¡œ ì„¸ì…˜ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤');
                        this.showNoActiveSession();
                        
                        // Update session status to stopped
                        this.activeSession.status = 'stopped';
                        this.activeSession.stoppedAt = new Date().toISOString();
                        
                        const userSessionsKey = `pomodoroSessions_${this.currentUser.id}`;
                        const sessions = JSON.parse(localStorage.getItem(userSessionsKey) || '[]');
                        const sessionIndex = sessions.findIndex(s => s.id === this.activeSession.id);
                        if (sessionIndex >= 0) {
                            sessions[sessionIndex] = this.activeSession;
                            localStorage.setItem(userSessionsKey, JSON.stringify(sessions));
                        }
                    }
                }

                updateUserStatsForCompletion(session) {
                    const userStatsKey = `userStats_${this.currentUser.id}`;
                    let userStats = JSON.parse(localStorage.getItem(userStatsKey) || '{}');
                    
                    if (!userStats.totalSessions) {
                        console.warn('ì‚¬ìš©ì í†µê³„ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    // Update completion stats
                    userStats.completedSessions++;
                    userStats.completedMinutes += session.duration;
                    
                    // Update daily completion stats
                    const today = new Date().toISOString().split('T')[0];
                    if (userStats.dailyStats[today]) {
                        userStats.dailyStats[today].completed++;
                    }
                    
                    // Update monthly completion stats
                    const month = today.substring(0, 7);
                    if (userStats.monthlyStats[month]) {
                        userStats.monthlyStats[month].completed++;
                    }
                    
                    localStorage.setItem(userStatsKey, JSON.stringify(userStats));
                    console.log('ğŸ“Š ì™„ë£Œ í†µê³„ ì—…ë°ì´íŠ¸:', userStats);
                }

                getUserStats() {
                    return window.userManager.getUserStats(this.currentUser.id);
                }

                getUserSessions() {
                    return window.userManager.getUserSessions(this.currentUser.id);
                }

                showToast(message, type = 'info', duration = 2000) {
                    console.log(`ğŸ’¬ í† ìŠ¤íŠ¸: ${message}`);
                    
                    const toast = document.createElement('div');
                    toast.textContent = message;
                    toast.style.cssText = `
                        position: fixed;
                        top: 120px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: ${type === 'success' ? '#34C759' : type === 'error' ? '#FF3B30' : '#007AFF'};
                        color: white;
                        padding: 12px 20px;
                        border-radius: 20px;
                        font-size: 14px;
                        font-weight: 500;
                        z-index: 1000;
                        opacity: 0;
                        transition: all 0.3s ease;
                        max-width: 280px;
                        text-align: center;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    `;
                    
                    document.body.appendChild(toast);
                    
                    setTimeout(() => {
                        toast.style.opacity = '1';
                        toast.style.transform = 'translateX(-50%) translateY(10px)';
                    }, 100);
                    
                    setTimeout(() => {
                        toast.style.opacity = '0';
                        setTimeout(() => {
                            if (document.body.contains(toast)) {
                                document.body.removeChild(toast);
                            }
                        }, 300);
                    }, duration);
                }
            }
            
            // MainDashboard ì´ˆê¸°í™”
            try {
                const dashboard = new MainDashboard();
                window.dashboard = dashboard;
                console.log('ğŸŒ Global dashboard ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ');
            } catch (error) {
                console.error('ğŸ’¥ MainDashboard ìƒì„± ì‹¤íŒ¨:', error);
                alert('í˜ì´ì§€ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        });
    </script>
</body>
</html>