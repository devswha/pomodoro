(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[642],{4995:function(e,r,t){Promise.resolve().then(t.bind(t,2028))},9376:function(e,r,t){"use strict";var i=t(5475);t.o(i,"usePathname")&&t.d(r,{usePathname:function(){return i.usePathname}}),t.o(i,"useRouter")&&t.d(r,{useRouter:function(){return i.useRouter}})},2028:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return u}});var i=t(7437),n=t(2265),s=t(9376),o=t(419);function l(e){let{children:r,requireAuth:t=!1}=e,{currentUser:l}=(0,o.a)(),u=(0,s.useRouter)();return((0,n.useEffect)(()=>{t&&!l&&u.push("/login")},[l,t,u]),t&&!l)?(0,i.jsx)("div",{children:"Loading..."}):r}function u(e){let{children:r}=e;return(0,i.jsx)(l,{requireAuth:!0,children:r})}},419:function(e,r,t){"use strict";t.d(r,{UserProvider:function(){return d},a:function(){return a}});var i=t(5583),n=t(1780),s=t(7437),o=t(2265),l=t(81);let u=(0,o.createContext)(),a=()=>{let e=(0,o.useContext)(u);if(!e)throw Error("useUser must be used within a UserProvider");return e},d=e=>{let{children:r}=e,[t,a]=(0,o.useState)(null),[d]=(0,o.useState)(()=>new l.w),[c,f]=(0,o.useState)(null),[g,h]=(0,o.useState)(null),[m,w]=(0,o.useState)(!1),[v,S]=(0,o.useState)(!0),[E,y]=(0,o.useState)(null);(0,o.useEffect)(()=>{(async()=>{try{let e=d.getCurrentSession();if(e){let r=d.getUser(e.userId);r?(a(r),h(e.token),w(!0),k(e.userId)):d.logoutSession()}}catch(e){console.error("Error initializing auth:",e),d.logoutSession()}finally{S(!1)}})();let e=setInterval(()=>{if(g){let e=d.validateSession(g);if(e){let r=new Date(e.expiresAt),t=new Date,i=r.getTime()-t.getTime();i>0&&i<=3e5&&!e.rememberMe?y("세션이 ".concat(Math.ceil(i/6e4),"분 후 만료됩니다.")):y(null)}else y("세션이 만료되어 자동으로 로그아웃됩니다."),setTimeout(()=>U(),3e3)}},3e4);return()=>clearInterval(e)},[d,g]);let P=async function(e,r){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{if(S(!0),y(null),!(null==e?void 0:e.trim()))throw Error("사용자명을 입력해주세요.");if(!r)throw Error("비밀번호를 입력해주세요.");let i=await d.loginUser(e.trim(),r,t);return a(i.user),h(i.sessionToken),w(!0),k(i.user.id),i.user}catch(e){if(console.error("Login failed:",e),e.message.includes("존재하지 않는"))throw Error("존재하지 않는 사용자입니다. 사용자명을 확인해주세요.");if(e.message.includes("비밀번호가 올바르지"))throw e;if(e.message.includes("일시적으로 잠겼습니다"))throw e;throw Error("로그인에 실패했습니다. 사용자명과 비밀번호를 확인해주세요.")}finally{S(!1)}},p=async(e,r)=>{try{var t;if(S(!0),y(null),!(null==e?void 0:e.trim()))throw Error("사용자명을 입력해주세요.");if(!(null==r?void 0:null===(t=r.email)||void 0===t?void 0:t.trim()))throw Error("이메일을 입력해주세요.");if(!(null==r?void 0:r.password))throw Error("비밀번호를 입력해주세요.");return await d.registerUser(e.trim(),(0,n._)((0,i._)({},r),{email:r.email.trim()}))}catch(e){if(console.error("Registration failed:",e),e.message.includes("이미 존재하는"))throw Error("이미 사용 중인 사용자명입니다. 다른 사용자명을 선택해주세요.");if(e.message.includes("이미 사용 중인 이메일"))throw Error("이미 사용 중인 이메일 주소입니다. 다른 이메일을 사용해주세요.");if(e.message.includes("비밀번호"))throw e;if(e.message.includes("이메일"))throw e;else if(e.message.includes("사용자명"))throw e;else throw Error("회원가입에 실패했습니다. 입력 정보를 확인하고 다시 시도해주세요.")}finally{S(!1)}},U=()=>{try{d.logoutSession(g),a(null),f(null),h(null),w(!1),y(null)}catch(e){console.error("Logout error:",e),a(null),f(null),h(null),w(!1),y(null)}},k=e=>{let r=d.getActiveSession(e);r&&(new Date<new Date(r.endTime)?f(r):(d.clearActiveSession(e),f(null)))},V=async e=>{if(!t)throw Error("No user logged in");try{let r=await d.updateUserProfile(t.id,e);return a(r),r}catch(e){throw console.error("Profile update failed:",e),e}};return(0,s.jsx)(u.Provider,{value:{currentUser:t,activeSession:c,sessionToken:g,isSessionValid:m,authLoading:v,sessionWarning:E,loginUser:P,registerUser:p,logoutUser:U,createPomodoroSession:e=>{if(!t)throw Error("No user logged in");let r=d.createPomodoroSession(t.id,e);return f(r),r},completePomodoroSession:()=>{t&&c&&(d.completePomodoroSession(t.id,c.id),f(null))},stopPomodoroSession:()=>{t&&c&&(d.stopPomodoroSession(t.id,c.id),f(null))},getUserStats:()=>t?d.getUserStats(t.id):null,getUserSessions:()=>t?d.getUserSessions(t.id):[],updateUserProfile:V,getUserActivity:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;return t?d.getUserActivity(t.id,e):null},validateCurrentSession:()=>!!g&&(!!d.validateSession(g)||(U(),!1)),checkPasswordStrength:e=>{if(!e)return{isValid:!1,errors:["비밀번호를 입력해주세요"],warnings:[],score:0,strength:"weak"};let r=[];e.length<4&&r.push("비밀번호는 4자 이상이어야 합니다");let t=Math.min(10*e.length,100),i={medium:t>=50&&t<80,strong:t>=80};return{isValid:0===r.length,errors:r,warnings:[],score:t,strength:i.strong?"strong":i.medium?"medium":"weak"}},validateEmail:e=>{if(!e||"string"!=typeof e)return{isValid:!1,error:"이메일을 입력해주세요."};let r=e.trim().toLowerCase();return r.includes("@")?{isValid:!0,normalizedEmail:r}:{isValid:!1,error:"이메일에 @가 포함되어야 합니다."}},validateUsername:e=>{if(!e||"string"!=typeof e)return{isValid:!1,error:"사용자명을 입력해주세요."};let r=e.trim();return r.length<1?{isValid:!1,error:"사용자명을 입력해주세요."}:r.length>50?{isValid:!1,error:"사용자명은 50자 이하여야 합니다."}:{isValid:!0,normalizedUsername:r.toLowerCase()}},extendSession:()=>!!(g&&d.validateSession(g))&&(y(null),!0),dismissSessionWarning:()=>{y(null)},userManager:d},children:r})}}},function(e){e.O(0,[81,971,966,744],function(){return e(e.s=4995)}),_N_E=e.O()}]);