"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[419],{419:function(e,r,t){t.d(r,{UserProvider:function(){return d},a:function(){return c}});var n=t(5583),s=t(1780),o=t(7437),i=t(2265),a=t(1968),u=t(81);let l=(0,i.createContext)(),c=()=>{let e=(0,i.useContext)(l);if(!e)throw Error("useUser must be used within a UserProvider");return e},d=e=>{let{children:r}=e,[t,c]=(0,i.useState)(null),[d,h]=(0,i.useState)(null),[f,g]=(0,i.useState)(null),[m,S]=(0,i.useState)(!1),[p,v]=(0,i.useState)(!0),[w,E]=(0,i.useState)(null),y=(0,i.useMemo)(()=>new u.ws,[]);(0,i.useEffect)(()=>{(async()=>{try{v(!0);let e=localStorage.getItem("sessionToken"),r=localStorage.getItem("currentUser");if(e&&r){let t=JSON.parse(r);c(t),g(e),S(!0)}v(!1)}catch(e){console.error("Error initializing auth:",e),v(!1)}})()},[]);let _=async function(e,r){arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{if(v(!0),!(null==e?void 0:e.trim()))throw Error("아이디를 입력해주세요.");if(!r)throw Error("비밀번호를 입력해주세요.");console.log("\uD83D\uDD10 LOGIN: Attempting login for '".concat(e.trim(),"'"));let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.trim(),password:r})}),o=await t.json();if(!t.ok)throw Error(o.error||"아이디 또는 비밀번호가 올바르지 않습니다.");console.log("✅ LOGIN: Authentication successful");let i=o.user,a=o.token;return c((0,s._)((0,n._)({},i),{display_name:i.display_name||i.username||i.id,username:i.username||i.id})),g(a),S(!0),localStorage.setItem("sessionToken",a),localStorage.setItem("currentUser",JSON.stringify(i)),i}catch(e){throw console.error("Login failed:",e),e}finally{v(!1)}},I=async(e,r)=>{try{var t,o,i,a,u,l;if(v(!0),!(null==e?void 0:e.trim()))throw Error("사용자명을 입력해주세요.");if(!(null==r?void 0:null===(t=r.email)||void 0===t?void 0:t.trim()))throw Error("이메일을 입력해주세요.");if(!(null==r?void 0:r.password)||r.password.length<6)throw Error("비밀번호는 6자 이상이어야 합니다.");console.log("\uD83D\uDD0D SIGNUP: Starting registration for '".concat(e.trim(),"'"));let c=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.trim(),email:r.email.trim(),password:r.password,confirmPassword:r.confirmPassword})}),d=await c.json();if(!c.ok)throw Error(d.error||"회원가입에 실패했습니다.");return(0,s._)((0,n._)({},d.user),{display_name:(null===(o=d.user)||void 0===o?void 0:o.display_name)||(null===(i=d.user)||void 0===i?void 0:i.username)||(null===(a=d.user)||void 0===a?void 0:a.id),username:(null===(u=d.user)||void 0===u?void 0:u.username)||(null===(l=d.user)||void 0===l?void 0:l.id)})}catch(e){throw console.error("Registration failed:",e),e}finally{v(!1)}},P=async()=>{try{localStorage.removeItem("sessionToken"),localStorage.removeItem("currentUser"),c(null),h(null),g(null),S(!1),E(null)}catch(e){console.error("Logout error:",e)}},b=async e=>{try{let{data:r}=await a.OQ.from("step_sessions").select("*").eq("user_id",e).eq("is_active",!0).order("start_time",{ascending:!1}).limit(1);r&&r.length>0&&h(r[0])}catch(e){console.error("Error loading active session:",e)}},O=async e=>{try{if(!t)throw Error("User not logged in");let r={user_id:t.id,title:e.title||"STEP Session",duration:e.duration||25,start_time:e.scheduledTime||new Date().toISOString(),status:"active",is_active:!0,session_type:"step"};e.goal&&(r.goal=e.goal),console.log("Inserting STEP session data:",r);let{data:n,error:s}=await a.OQ.from("step_sessions").insert(r).select().single();if(s)throw console.error("Supabase error creating session:",s),console.error("Error details:",s.message,s.details,s.hint),s;return h(n),n}catch(e){throw console.error("Error creating STEP session:",e),e}},U=async()=>{try{if(!d)return;let{error:e}=await a.OQ.from("step_sessions").update({end_time:new Date().toISOString(),status:"completed",is_active:!1}).eq("id",d.id);if(e)throw e;h(null)}catch(e){console.error("Error stopping STEP session:",e)}};return(0,o.jsx)(l.Provider,{value:{currentUser:t,activeSession:d,sessionToken:f,isSessionValid:m,authLoading:p,sessionWarning:w,loginUser:_,registerUser:I,logoutUser:P,setActiveSession:h,loadActiveSession:b,createSTEPSession:O,stopSTEPSession:U,userManager:y,validateUsername:e=>(0,u.rV)(e),validateEmail:e=>(0,u.oH)(e),checkPasswordStrength:e=>(0,u.Qc)(e)},children:r})}},1968:function(e,r,t){t.d(r,{OQ:function(){return d},ji:function(){return h}});var n=t(8439),s=t(257);let o="https://lasoynzegoiktncjzqad.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxhc295bnplZ29pa3RuY2p6cWFkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxNzkwMTEsImV4cCI6MjA3Mzc1NTAxMX0.zHQX-LwBBqE3S2xpQW38ZqNbHlqKHnxCKuFX8IEhM2k",a=s.env.SUPABASE_SERVICE_ROLE_KEY,u=e=>{if(!e||e.includes("your_supabase")||e.includes("placeholder")||e.includes("demo.supabase.co"))return!1;try{return new URL(e),e.includes("supabase.co")}catch(e){return!1}},l=u(o)&&i&&!i.includes("your_");console.log("Supabase Configuration Status:",{url:o?"Present":"Missing",urlValid:u(o),anonKey:i?"Present":"Missing",anonKeyValid:i&&!i.includes("your_"),hasValidConfig:l});let c=()=>{let e={select:function(){return this},insert:function(){return this},update:function(){return this},delete:function(){return this},eq:function(){return this},neq:function(){return this},gt:function(){return this},gte:function(){return this},lt:function(){return this},lte:function(){return this},like:function(){return this},ilike:function(){return this},is:function(){return this},in:function(){return this},contains:function(){return this},containedBy:function(){return this},rangeGt:function(){return this},rangeGte:function(){return this},rangeLt:function(){return this},rangeLte:function(){return this},rangeAdjacent:function(){return this},overlaps:function(){return this},textSearch:function(){return this},match:function(){return this},not:function(){return this},or:function(){return this},filter:function(){return this},order:function(){return this},limit:function(){return this},range:function(){return this},abortSignal:function(){return this},single:function(){return Promise.resolve({data:null,error:{message:"Using localStorage mode - no data available"}})},maybeSingle:function(){return Promise.resolve({data:null,error:null})},then:function(e){return e({data:[],error:null})},catch:function(){return this}};return{from:()=>e,auth:{signUp:()=>Promise.resolve({data:{user:null,session:null},error:{message:"Using localStorage mode"}}),signInWithPassword:()=>Promise.resolve({data:{user:null,session:null},error:{message:"Using localStorage mode"}}),signOut:()=>Promise.resolve({error:null}),getUser:()=>Promise.resolve({data:{user:null},error:{message:"Using localStorage mode"}}),getSession:()=>Promise.resolve({data:{session:null},error:null}),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}})},channel:()=>({on:function(){return this},subscribe:()=>Promise.resolve("SUBSCRIBED"),unsubscribe:()=>{},track:()=>Promise.resolve(),send:()=>Promise.resolve(),presenceState:()=>({})}),realtime:{disconnect:()=>{}}}},d=l?(0,n.eI)(o,i,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:window.localStorage},realtime:{params:{eventsPerSecond:10}}}):c();l&&a?(0,n.eI)(o,a,{auth:{autoRefreshToken:!1,persistSession:!1}}):c();let h={USERS:"users",USER_PREFERENCES:"user_preferences",USER_STATS:"user_stats",POMODORO_SESSIONS:"pomodoro_sessions",MEETINGS:"meetings",AUTH_SESSIONS:"auth_sessions"}}}]);