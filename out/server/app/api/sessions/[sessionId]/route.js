"use strict";(()=>{var e={};e.id=83,e.ids=[83],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},9882:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>O,patchFetch:()=>Z,requestAsyncStorage:()=>g,routeModule:()=>S,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var s={};a.r(s),a.d(s,{DELETE:()=>R,GET:()=>x,PUT:()=>y});var o=a(9303),i=a(8716),r=a(670),n=a(1595),d=a(7246),l=a(2859),u=a(7258);async function m(e,t){if(await new Promise((a,s)=>{(0,u.mk)(e,t,e=>{e?s(e):a()})}),!n.pR)return(0,l.y7)(t,"Database access not available",503);try{let a=e.userId,{sessionId:s}=e.params,{data:o,error:i}=await n.pR.from(n.ji.POMODORO_SESSIONS).select("*").eq("id",s).eq("user_id",a).single();if(i||!o)return(0,l.Ij)(t,"Session not found");return(0,l.Wr)(t,o)}catch(e){return console.error("Get session error:",e),(0,l.y7)(t,"Failed to retrieve session",500)}}async function p(e,t){if(await new Promise((a,s)=>{(0,u.mk)(e,t,e=>{e?s(e):a()})}),!n.pR)return(0,l.y7)(t,"Database access not available",503);let a=(0,d.Fv)(d.Db,e.body);if(!a.success)return(0,l.Gc)(t,a.errors);try{let s=e.userId,{sessionId:o}=e.params,i=a.data,{data:r,error:d}=await n.pR.from(n.ji.POMODORO_SESSIONS).select("*").eq("id",o).eq("user_id",s).single();if(d||!r)return(0,l.Ij)(t,"Session not found");let{data:u,error:m}=await n.pR.from(n.ji.POMODORO_SESSIONS).update({...i,updated_at:new Date().toISOString()}).eq("id",o).eq("user_id",s).select().single();if(m)return console.error("Failed to update session:",m),(0,l.y7)(t,"Failed to update session",500);return"completed"===i.status&&"completed"!==r.status&&await _(s,u),(0,l.Wr)(t,u,"Session updated successfully")}catch(e){return console.error("Update session error:",e),(0,l.y7)(t,"Failed to update session",500)}}async function c(e,t){if(await new Promise((a,s)=>{(0,u.mk)(e,t,e=>{e?s(e):a()})}),!n.pR)return(0,l.y7)(t,"Database access not available",503);try{let a=e.userId,{sessionId:s}=e.params,{data:o,error:i}=await n.pR.from(n.ji.POMODORO_SESSIONS).select("*").eq("id",s).eq("user_id",a).single();if(i||!o)return(0,l.Ij)(t,"Session not found");let{error:r}=await n.pR.from(n.ji.POMODORO_SESSIONS).delete().eq("id",s).eq("user_id",a);if(r)return console.error("Failed to delete session:",r),(0,l.y7)(t,"Failed to delete session",500);return await f(a,o),(0,l.Wr)(t,null,"Session deleted successfully")}catch(e){return console.error("Delete session error:",e),(0,l.y7)(t,"Failed to delete session",500)}}async function _(e,t){try{let{data:a}=await n.pR.from(n.ji.USER_STATS).select("*").eq("user_id",e).single();if(a){let s={completed_sessions:a.completed_sessions+1,completed_minutes:a.completed_minutes+t.duration,updated_at:new Date().toISOString()};s.completion_rate=Math.round(s.completed_sessions/a.total_sessions*100),s.completed_sessions>0&&(s.average_session_length=Math.round(s.completed_minutes/s.completed_sessions));let o=new Date().toISOString().split("T")[0],i=a.last_session_date;if(!i||i!==o){if(i){let e=new Date(i),t=new Date(o),r=Math.floor((t-e)/864e5);1===r?s.streak_days=a.streak_days+1:0===r?s.streak_days=a.streak_days:s.streak_days=1}else s.streak_days=1;s.last_session_date=o,s.streak_days>a.longest_streak&&(s.longest_streak=s.streak_days)}await n.pR.from(n.ji.USER_STATS).update(s).eq("user_id",e)}}catch(e){console.error("Failed to update completion stats:",e)}}async function f(e,t){try{let{data:a}=await n.pR.from(n.ji.USER_STATS).select("*").eq("user_id",e).single();if(a){let s={total_sessions:Math.max(0,a.total_sessions-1),total_minutes:Math.max(0,a.total_minutes-t.duration),updated_at:new Date().toISOString()};"completed"===t.status&&(s.completed_sessions=Math.max(0,a.completed_sessions-1),s.completed_minutes=Math.max(0,a.completed_minutes-t.duration)),s.total_sessions>0?s.completion_rate=Math.round(s.completed_sessions/s.total_sessions*100):s.completion_rate=0,s.completed_sessions>0?s.average_session_length=Math.round(s.completed_minutes/s.completed_sessions):s.average_session_length=0,await n.pR.from(n.ji.USER_STATS).update(s).eq("user_id",e)}}catch(e){console.error("Failed to update stats after deletion:",e)}}let x=(0,l.bi)(m),y=(0,l.bi)(p),R=(0,l.bi)(c),S=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/sessions/[sessionId]/route",pathname:"/api/sessions/[sessionId]",filename:"route",bundlePath:"app/api/sessions/[sessionId]/route"},resolvedPagePath:"/home/devswha/workspace/pomodoro/app/api/sessions/[sessionId]/route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:w}=S,O="/api/sessions/[sessionId]/route";function Z(){return(0,r.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},7246:(e,t,a)=>{a.d(t,{$p:()=>R,CG:()=>S,Db:()=>f,Fv:()=>w,Mk:()=>_,Vp:()=>p,W0:()=>h,bd:()=>y,dm:()=>m,g2:()=>g,gY:()=>u,sQ:()=>x,xH:()=>c});var s=a(1598),o=a(7254),i=a(9489);let r=s.Z_().email("Invalid email address").toLowerCase(),n=s.Z_().min(4,"Password must be at least 4 characters"),d=s.Z_().min(1,"Username is required").max(50,"Username too long");s.Z_().uuid("Invalid UUID format"),s.Rx().int().positive();let l=s.Z_().datetime("Invalid date format"),u=s.Ry({username:d,email:r,password:n,displayName:s.Z_().max(100).optional()}),m=s.Ry({username:d,password:s.Z_().min(1,"Password is required"),rememberMe:s.O7().default(!1)}),p=(s.Ry({currentPassword:s.Z_().min(1,"Current password is required"),newPassword:n}),s.Ry({displayName:s.Z_().max(100).optional(),email:r.optional(),bio:s.Z_().max(500).optional(),avatar:s.Z_().url().optional().or(s.i0(""))})),c=s.Ry({defaultPomodoroLength:s.Rx().int().min(1).max(120).default(25),breakLength:s.Rx().int().min(1).max(30).default(5),longBreakLength:s.Rx().int().min(1).max(60).default(15),weeklyGoal:s.Rx().int().min(1).max(1e3).default(140),theme:s.Km(["default","dark","minimal"]).default("default"),soundEnabled:s.O7().default(!0),notificationsEnabled:s.O7().default(!0),autoStartBreak:s.O7().default(!1),autoStartPomodoro:s.O7().default(!1)}),_=s.Ry({title:s.Z_().min(1,"Session title is required").max(200),goal:s.Z_().max(500).optional(),tags:s.Z_().max(200).optional(),location:s.Z_().max(100).optional(),duration:s.Rx().int().min(1).max(120).default(25),scheduledTime:l.optional()}),f=s.Ry({title:s.Z_().min(1).max(200).optional(),goal:s.Z_().max(500).optional(),tags:s.Z_().max(200).optional(),location:s.Z_().max(100).optional(),status:s.Km(["scheduled","active","completed","stopped"]).optional()}),x=s.Ry({page:o.Rx().int().min(1).default(1),limit:o.Rx().int().min(1).max(100).default(20),status:s.Km(["scheduled","active","completed","stopped"]).optional(),startDate:s.Z_().date().optional(),endDate:s.Z_().date().optional(),tags:s.Z_().optional()}),y=s.Ry({title:s.Z_().min(1,"Meeting title is required").max(200),description:s.Z_().max(1e3).optional(),date:s.Z_().date("Invalid date format"),time:s.Z_().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format (HH:MM)"),duration:s.Rx().int().min(15).max(480).default(60),location:s.Z_().max(200).optional(),participants:s.IX(s.Z_().email()).optional(),type:s.Km(["meeting","call","presentation","workshop","other"]).default("meeting"),priority:s.Km(["low","medium","high"]).default("medium"),reminderMinutes:s.Rx().int().min(0).max(10080).default(15)}),R=y.partial(),S=s.Ry({date:s.Z_().date().optional(),startDate:s.Z_().date().optional(),endDate:s.Z_().date().optional(),type:s.Km(["meeting","call","presentation","workshop","other"]).optional(),priority:s.Km(["low","medium","high"]).optional()}),g=s.Ry({period:s.Km(["day","week","month","year"]).default("week"),startDate:s.Z_().date().optional(),endDate:s.Z_().date().optional()}),h=s.Ry({period:s.Km(["week","month","year"]).default("week"),limit:o.Rx().int().min(1).max(100).default(10)}),w=(s.Ry({page:o.Rx().int().min(1).default(1),limit:o.Rx().int().min(1).max(100).default(20)}),s.Ry({sortBy:s.Z_().optional(),sortOrder:s.Km(["asc","desc"]).default("desc")}),(e,t)=>{try{return{success:!0,data:e.parse(t),errors:null}}catch(e){if(e instanceof i.j)return{success:!1,data:null,errors:(e.errors||[]).map(e=>({field:e.path?.join(".")||"unknown",message:e.message,code:e.code}))};return{success:!1,data:null,errors:[{message:"Validation failed",code:"unknown_error"}]}}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[948,766,482,254,258],()=>a(9882));module.exports=s})();