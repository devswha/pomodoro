"use strict";(()=>{var e={};e.id=772,e.ids=[772],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},6714:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>S,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>x,serverHooks:()=>R,staticGenerationAsyncStorage:()=>y});var i={};a.r(i),a.d(i,{GET:()=>_,POST:()=>f});var o=a(9303),r=a(8716),s=a(670),n=a(1595),l=a(7246),d=a(2859),u=a(7258);async function m(e,t){if(await new Promise((a,i)=>{(0,u.mk)(e,t,e=>{e?i(e):a()})}),!n.pR)return(0,d.y7)(t,"Database access not available",503);let a=(0,l.Fv)(l.sQ,e.query||{});if(!a.success)return(0,d.Gc)(t,a.errors);try{let i=e.userId,{page:o,limit:r,status:s,startDate:l,endDate:u,tags:m}=a.data,p=n.pR.from(n.ji.POMODORO_SESSIONS).select("*",{count:"exact"}).eq("user_id",i);s&&(p=p.eq("status",s)),l&&(p=p.gte("start_time",`${l}T00:00:00`)),u&&(p=p.lte("start_time",`${u}T23:59:59`)),m&&(p=p.ilike("tags",`%${m}%`));let c=(o-1)*r,_=c+r-1;p=p.range(c,_).order("start_time",{ascending:!1});let{data:f,count:x,error:g}=await p;if(g)return console.error("Failed to get sessions:",g),(0,d.y7)(t,"Failed to retrieve sessions",500);let y=(0,d.kv)(o,r,x);return(0,d.Wr)(t,f,"Sessions retrieved successfully",200,y)}catch(e){return console.error("Get sessions error:",e),(0,d.y7)(t,"Failed to retrieve sessions",500)}}async function p(e,t){if(await new Promise((a,i)=>{(0,u.mk)(e,t,e=>{e?i(e):a()})}),!n.pR)return(0,d.y7)(t,"Database access not available",503);let a=(0,l.Fv)(l.Mk,e.body);if(!a.success)return(0,d.Gc)(t,a.errors);try{let i;let o=e.userId,r=a.data,{data:s}=await n.pR.from(n.ji.POMODORO_SESSIONS).select("id").eq("user_id",o).eq("status","active").single();if(s)return(0,d.y7)(t,"You already have an active session. Please complete or stop it first.",409);let l=new Date;if(r.scheduledTime){let e=new Date(r.scheduledTime);i=e>l?e:l}else i=l;let u=6e4*r.duration,m=new Date(i.getTime()+u),p={user_id:o,title:r.title,goal:r.goal||null,tags:r.tags||null,location:r.location||null,duration:r.duration,start_time:i.toISOString(),end_time:m.toISOString(),status:i>l?"scheduled":"active",created_at:l.toISOString(),updated_at:l.toISOString()},{data:_,error:f}=await n.pR.from(n.ji.POMODORO_SESSIONS).insert(p).select().single();if(f)return console.error("Failed to create session:",f),(0,d.y7)(t,"Failed to create session",500);return await c(o,_),(0,d.Wr)(t,_,"Session created successfully",201)}catch(e){return console.error("Create session error:",e),(0,d.y7)(t,"Failed to create session",500)}}async function c(e,t){try{let{data:a}=await n.pR.from(n.ji.USER_STATS).select("*").eq("user_id",e).single();if(a){let i={total_sessions:a.total_sessions+1,total_minutes:a.total_minutes+t.duration,updated_at:new Date().toISOString()};i.total_sessions>0&&(i.completion_rate=Math.round(a.completed_sessions/i.total_sessions*100)),await n.pR.from(n.ji.USER_STATS).update(i).eq("user_id",e)}else await n.pR.from(n.ji.USER_STATS).insert({user_id:e,total_sessions:1,completed_sessions:0,total_minutes:t.duration,completed_minutes:0,streak_days:0,longest_streak:0,weekly_goal:140,completion_rate:0,average_session_length:0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})}catch(e){console.error("Failed to update user stats:",e)}}let _=(0,d.bi)(m),f=(0,d.bi)(p),x=new o.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/sessions/route",pathname:"/api/sessions",filename:"route",bundlePath:"app/api/sessions/route"},resolvedPagePath:"/home/devswha/workspace/pomodoro/app/api/sessions/route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:R}=x,S="/api/sessions/route";function w(){return(0,s.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:y})}},7246:(e,t,a)=>{a.d(t,{$p:()=>y,CG:()=>R,Db:()=>f,Fv:()=>h,Mk:()=>_,Vp:()=>p,W0:()=>w,bd:()=>g,dm:()=>m,g2:()=>S,gY:()=>u,sQ:()=>x,xH:()=>c});var i=a(1598),o=a(7254),r=a(9489);let s=i.Z_().email("Invalid email address").toLowerCase(),n=i.Z_().min(4,"Password must be at least 4 characters"),l=i.Z_().min(1,"Username is required").max(50,"Username too long");i.Z_().uuid("Invalid UUID format"),i.Rx().int().positive();let d=i.Z_().datetime("Invalid date format"),u=i.Ry({username:l,email:s,password:n,displayName:i.Z_().max(100).optional()}),m=i.Ry({username:l,password:i.Z_().min(1,"Password is required"),rememberMe:i.O7().default(!1)}),p=(i.Ry({currentPassword:i.Z_().min(1,"Current password is required"),newPassword:n}),i.Ry({displayName:i.Z_().max(100).optional(),email:s.optional(),bio:i.Z_().max(500).optional(),avatar:i.Z_().url().optional().or(i.i0(""))})),c=i.Ry({defaultPomodoroLength:i.Rx().int().min(1).max(120).default(25),breakLength:i.Rx().int().min(1).max(30).default(5),longBreakLength:i.Rx().int().min(1).max(60).default(15),weeklyGoal:i.Rx().int().min(1).max(1e3).default(140),theme:i.Km(["default","dark","minimal"]).default("default"),soundEnabled:i.O7().default(!0),notificationsEnabled:i.O7().default(!0),autoStartBreak:i.O7().default(!1),autoStartPomodoro:i.O7().default(!1)}),_=i.Ry({title:i.Z_().min(1,"Session title is required").max(200),goal:i.Z_().max(500).optional(),tags:i.Z_().max(200).optional(),location:i.Z_().max(100).optional(),duration:i.Rx().int().min(1).max(120).default(25),scheduledTime:d.optional()}),f=i.Ry({title:i.Z_().min(1).max(200).optional(),goal:i.Z_().max(500).optional(),tags:i.Z_().max(200).optional(),location:i.Z_().max(100).optional(),status:i.Km(["scheduled","active","completed","stopped"]).optional()}),x=i.Ry({page:o.Rx().int().min(1).default(1),limit:o.Rx().int().min(1).max(100).default(20),status:i.Km(["scheduled","active","completed","stopped"]).optional(),startDate:i.Z_().date().optional(),endDate:i.Z_().date().optional(),tags:i.Z_().optional()}),g=i.Ry({title:i.Z_().min(1,"Meeting title is required").max(200),description:i.Z_().max(1e3).optional(),date:i.Z_().date("Invalid date format"),time:i.Z_().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format (HH:MM)"),duration:i.Rx().int().min(15).max(480).default(60),location:i.Z_().max(200).optional(),participants:i.IX(i.Z_().email()).optional(),type:i.Km(["meeting","call","presentation","workshop","other"]).default("meeting"),priority:i.Km(["low","medium","high"]).default("medium"),reminderMinutes:i.Rx().int().min(0).max(10080).default(15)}),y=g.partial(),R=i.Ry({date:i.Z_().date().optional(),startDate:i.Z_().date().optional(),endDate:i.Z_().date().optional(),type:i.Km(["meeting","call","presentation","workshop","other"]).optional(),priority:i.Km(["low","medium","high"]).optional()}),S=i.Ry({period:i.Km(["day","week","month","year"]).default("week"),startDate:i.Z_().date().optional(),endDate:i.Z_().date().optional()}),w=i.Ry({period:i.Km(["week","month","year"]).default("week"),limit:o.Rx().int().min(1).max(100).default(10)}),h=(i.Ry({page:o.Rx().int().min(1).default(1),limit:o.Rx().int().min(1).max(100).default(20)}),i.Ry({sortBy:i.Z_().optional(),sortOrder:i.Km(["asc","desc"]).default("desc")}),(e,t)=>{try{return{success:!0,data:e.parse(t),errors:null}}catch(e){if(e instanceof r.j)return{success:!1,data:null,errors:(e.errors||[]).map(e=>({field:e.path?.join(".")||"unknown",message:e.message,code:e.code}))};return{success:!1,data:null,errors:[{message:"Validation failed",code:"unknown_error"}]}}})}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[948,766,482,254,258],()=>a(6714));module.exports=i})();