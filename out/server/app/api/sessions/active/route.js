"use strict";(()=>{var e={};e.id=858,e.ids=[858],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},8801:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>_,serverHooks:()=>v,staticGenerationAsyncStorage:()=>S});var r={};s.r(r),s.d(r,{GET:()=>l});var a=s(9303),o=s(8716),i=s(670),n=s(1595),d=s(2859),p=s(7258);async function u(e,t){if(await new Promise((s,r)=>{(0,p.mk)(e,t,e=>{e?r(e):s()})}),!n.pR)return(0,d.y7)(t,"Database access not available",503);try{let s=e.userId,{data:r,error:a}=await n.pR.from(n.ji.POMODORO_SESSIONS).select("*").eq("user_id",s).eq("status","active").single();if(a&&"PGRST116"!==a.code)return console.error("Failed to get active session:",a),(0,d.y7)(t,"Failed to retrieve active session",500);if(!r)return(0,d.Wr)(t,null,"No active session found");let o=new Date,i=new Date(r.end_time);if(o>=i){let{data:e,error:a}=await n.pR.from(n.ji.POMODORO_SESSIONS).update({status:"completed",completed_at:i.toISOString(),updated_at:o.toISOString()}).eq("id",r.id).select().single();if(!a)return await c(s,e),(0,d.Wr)(t,{...e,autoCompleted:!0},"Session auto-completed")}return(0,d.Wr)(t,r)}catch(e){return console.error("Get active session error:",e),(0,d.y7)(t,"Failed to retrieve active session",500)}}let l=(0,d.bi)(u);async function c(e,t){try{let{data:s}=await n.pR.from(n.ji.USER_STATS).select("*").eq("user_id",e).single();if(s){let r={completed_sessions:s.completed_sessions+1,completed_minutes:s.completed_minutes+t.duration,updated_at:new Date().toISOString()};r.completion_rate=Math.round(r.completed_sessions/s.total_sessions*100),r.completed_sessions>0&&(r.average_session_length=Math.round(r.completed_minutes/r.completed_sessions));let a=new Date().toISOString().split("T")[0],o=s.last_session_date;if(!o||o!==a){if(o){let e=new Date(o),t=new Date(a),i=Math.floor((t-e)/864e5);1===i?r.streak_days=s.streak_days+1:0===i?r.streak_days=s.streak_days:r.streak_days=1}else r.streak_days=1;r.last_session_date=a,r.streak_days>s.longest_streak&&(r.longest_streak=r.streak_days)}await n.pR.from(n.ji.USER_STATS).update(r).eq("user_id",e)}}catch(e){console.error("Failed to update completion stats:",e)}}let _=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/sessions/active/route",pathname:"/api/sessions/active",filename:"route",bundlePath:"app/api/sessions/active/route"},resolvedPagePath:"/home/devswha/workspace/pomodoro/app/api/sessions/active/route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:S,serverHooks:v}=_,f="/api/sessions/active/route";function g(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:S})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,766,482,258],()=>s(8801));module.exports=r})();