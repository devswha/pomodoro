"use strict";(()=>{var e={};e.id=397,e.ids=[397],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},4603:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>_,serverHooks:()=>g,staticGenerationAsyncStorage:()=>S});var r={};s.r(r),s.d(r,{POST:()=>c});var o=s(9303),a=s(8716),i=s(670),n=s(1595),p=s(2859),l=s(7258);async function d(e,t){if((0,p.P)(e,t,["POST"])){if(await new Promise((s,r)=>{(0,l.mk)(e,t,e=>{e?r(e):s()})}),!n.pR)return(0,p.y7)(t,"Database access not available",503);try{let s=e.userId,{data:r,error:o}=await n.pR.from(n.ji.POMODORO_SESSIONS).select("*").eq("user_id",s).eq("status","active").single();if(o||!r)return(0,p.Ij)(t,"No active session found to complete");let a=new Date,{data:i,error:l}=await n.pR.from(n.ji.POMODORO_SESSIONS).update({status:"completed",completed_at:a.toISOString(),updated_at:a.toISOString()}).eq("id",r.id).select().single();if(l)return console.error("Failed to complete session:",l),(0,p.y7)(t,"Failed to complete session",500);return await u(s,i),(0,p.Wr)(t,i,"Session completed successfully")}catch(e){return console.error("Complete session error:",e),(0,p.y7)(t,"Failed to complete session",500)}}}async function u(e,t){try{let{data:s}=await n.pR.from(n.ji.USER_STATS).select("*").eq("user_id",e).single();if(!s){await n.pR.from(n.ji.USER_STATS).insert({user_id:e,total_sessions:1,completed_sessions:1,total_minutes:t.duration,completed_minutes:t.duration,streak_days:1,longest_streak:1,last_session_date:new Date().toISOString().split("T")[0],weekly_goal:140,completion_rate:100,average_session_length:t.duration,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});return}let r={completed_sessions:s.completed_sessions+1,completed_minutes:s.completed_minutes+t.duration,updated_at:new Date().toISOString()};r.completion_rate=Math.round(r.completed_sessions/s.total_sessions*100),r.completed_sessions>0&&(r.average_session_length=Math.round(r.completed_minutes/r.completed_sessions));let o=new Date().toISOString().split("T")[0],a=s.last_session_date;if(!a||a!==o){if(a){let e=new Date(a),t=new Date(o),i=Math.floor((t-e)/864e5);1===i?r.streak_days=s.streak_days+1:0===i?r.streak_days=s.streak_days:r.streak_days=1}else r.streak_days=1;r.last_session_date=o,r.streak_days>s.longest_streak&&(r.longest_streak=r.streak_days)}await n.pR.from(n.ji.USER_STATS).update(r).eq("user_id",e)}catch(e){console.error("Failed to update completion stats:",e)}}let c=(0,p.bi)(d),_=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/sessions/active/complete/route",pathname:"/api/sessions/active/complete",filename:"route",bundlePath:"app/api/sessions/active/complete/route"},resolvedPagePath:"/home/devswha/workspace/pomodoro/app/api/sessions/active/complete/route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:S,serverHooks:g}=_,f="/api/sessions/active/complete/route";function y(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:S})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,766,482,258],()=>s(4603));module.exports=r})();