"use strict";(()=>{var e={};e.id=508,e.ids=[508],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},7078:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>_,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>x});var r={};a.r(r),a.d(r,{GET:()=>p});var o=a(9303),i=a(8716),s=a(670),n=a(1595),d=a(7246),l=a(2859),u=a(7258);async function m(e,t){if(!(0,l.P)(e,t,["GET"]))return;if(await new Promise((a,r)=>{(0,u.Rw)(e,t,e=>{e?r(e):a()})}),!n.pR)return(0,l.y7)(t,"Database access not available",503);let a=(0,d.Fv)(d.W0,e.query||{});if(!a.success)return(0,l.Gc)(t,a.errors);try{let r;let{period:o,limit:i}=a.data,s=e.userId,d=new Date;switch(o){case"week":default:(r=new Date(d)).setDate(d.getDate()-d.getDay());break;case"month":r=new Date(d.getFullYear(),d.getMonth(),1);break;case"year":r=new Date(d.getFullYear(),0,1)}let u=r.toISOString().split("T")[0],m=d.toISOString().split("T")[0],{data:p,error:c}=await n.pR.from(n.ji.POMODORO_SESSIONS).select(`
        user_id,
        duration,
        status,
        start_time
      `).eq("status","completed").gte("start_time",`${u}T00:00:00`).lte("start_time",`${m}T23:59:59`);if(c)return console.error("Failed to get leaderboard sessions:",c),(0,l.y7)(t,"Failed to retrieve leaderboard data",500);let g={};(p||[]).forEach(e=>{let{user_id:t,duration:a}=e;g[t]||(g[t]={userId:t,completedSessions:0,completedMinutes:0,averageSessionLength:0}),g[t].completedSessions++,g[t].completedMinutes+=a||0});let x=Object.values(g).map(e=>({...e,averageSessionLength:e.completedSessions>0?Math.round(e.completedMinutes/e.completedSessions):0}));x.sort((e,t)=>t.completedMinutes!==e.completedMinutes?t.completedMinutes-e.completedMinutes:t.completedSessions-e.completedSessions);let h=x.slice(0,i).map(e=>e.userId),{data:f}=h.length>0?await n.pR.from(n.ji.USERS).select(`
        id,
        username,
        display_name,
        avatar_url
      `).in("id",h):{data:[]},_={};(f||[]).forEach(e=>{_[e.id]=e});let y=x.slice(0,i).map((e,t)=>{let a=_[e.userId];return{rank:t+1,userId:e.userId,username:a?a.username:"Anonymous",displayName:a?a.display_name:"Anonymous User",avatarUrl:a?a.avatar_url:null,completedSessions:e.completedSessions,completedMinutes:e.completedMinutes,averageSessionLength:e.averageSessionLength,isCurrentUser:s&&e.userId===s}}),R=null;if(s){let e=x.findIndex(e=>e.userId===s);-1!==e&&(R={rank:e+1,completedSessions:x[e].completedSessions,completedMinutes:x[e].completedMinutes,averageSessionLength:x[e].averageSessionLength})}let v={leaderboard:y,period:o,dateRange:{start:u,end:m},totalParticipants:x.length,currentUserRank:R,periodStats:{totalSessions:p?p.length:0,totalMinutes:p?p.reduce((e,t)=>e+(t.duration||0),0):0,averageSessionLength:p&&p.length>0?Math.round(p.reduce((e,t)=>e+(t.duration||0),0)/p.length):0}};return(0,l.Wr)(t,v)}catch(e){return console.error("Leaderboard error:",e),(0,l.y7)(t,"Failed to load leaderboard",500)}}let p=(0,l.bi)(m),c=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/dashboard/leaderboard/route",pathname:"/api/dashboard/leaderboard",filename:"route",bundlePath:"app/api/dashboard/leaderboard/route"},resolvedPagePath:"/home/devswha/workspace/pomodoro/app/api/dashboard/leaderboard/route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:h}=c,f="/api/dashboard/leaderboard/route";function _(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:x})}},7246:(e,t,a)=>{a.d(t,{$p:()=>_,CG:()=>y,Db:()=>x,Fv:()=>w,Mk:()=>g,Vp:()=>p,W0:()=>v,bd:()=>f,dm:()=>m,g2:()=>R,gY:()=>u,sQ:()=>h,xH:()=>c});var r=a(1598),o=a(7254),i=a(9489);let s=r.Z_().email("Invalid email address").toLowerCase(),n=r.Z_().min(4,"Password must be at least 4 characters"),d=r.Z_().min(1,"Username is required").max(50,"Username too long");r.Z_().uuid("Invalid UUID format"),r.Rx().int().positive();let l=r.Z_().datetime("Invalid date format"),u=r.Ry({username:d,email:s,password:n,displayName:r.Z_().max(100).optional()}),m=r.Ry({username:d,password:r.Z_().min(1,"Password is required"),rememberMe:r.O7().default(!1)}),p=(r.Ry({currentPassword:r.Z_().min(1,"Current password is required"),newPassword:n}),r.Ry({displayName:r.Z_().max(100).optional(),email:s.optional(),bio:r.Z_().max(500).optional(),avatar:r.Z_().url().optional().or(r.i0(""))})),c=r.Ry({defaultPomodoroLength:r.Rx().int().min(1).max(120).default(25),breakLength:r.Rx().int().min(1).max(30).default(5),longBreakLength:r.Rx().int().min(1).max(60).default(15),weeklyGoal:r.Rx().int().min(1).max(1e3).default(140),theme:r.Km(["default","dark","minimal"]).default("default"),soundEnabled:r.O7().default(!0),notificationsEnabled:r.O7().default(!0),autoStartBreak:r.O7().default(!1),autoStartPomodoro:r.O7().default(!1)}),g=r.Ry({title:r.Z_().min(1,"Session title is required").max(200),goal:r.Z_().max(500).optional(),tags:r.Z_().max(200).optional(),location:r.Z_().max(100).optional(),duration:r.Rx().int().min(1).max(120).default(25),scheduledTime:l.optional()}),x=r.Ry({title:r.Z_().min(1).max(200).optional(),goal:r.Z_().max(500).optional(),tags:r.Z_().max(200).optional(),location:r.Z_().max(100).optional(),status:r.Km(["scheduled","active","completed","stopped"]).optional()}),h=r.Ry({page:o.Rx().int().min(1).default(1),limit:o.Rx().int().min(1).max(100).default(20),status:r.Km(["scheduled","active","completed","stopped"]).optional(),startDate:r.Z_().date().optional(),endDate:r.Z_().date().optional(),tags:r.Z_().optional()}),f=r.Ry({title:r.Z_().min(1,"Meeting title is required").max(200),description:r.Z_().max(1e3).optional(),date:r.Z_().date("Invalid date format"),time:r.Z_().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format (HH:MM)"),duration:r.Rx().int().min(15).max(480).default(60),location:r.Z_().max(200).optional(),participants:r.IX(r.Z_().email()).optional(),type:r.Km(["meeting","call","presentation","workshop","other"]).default("meeting"),priority:r.Km(["low","medium","high"]).default("medium"),reminderMinutes:r.Rx().int().min(0).max(10080).default(15)}),_=f.partial(),y=r.Ry({date:r.Z_().date().optional(),startDate:r.Z_().date().optional(),endDate:r.Z_().date().optional(),type:r.Km(["meeting","call","presentation","workshop","other"]).optional(),priority:r.Km(["low","medium","high"]).optional()}),R=r.Ry({period:r.Km(["day","week","month","year"]).default("week"),startDate:r.Z_().date().optional(),endDate:r.Z_().date().optional()}),v=r.Ry({period:r.Km(["week","month","year"]).default("week"),limit:o.Rx().int().min(1).max(100).default(10)}),w=(r.Ry({page:o.Rx().int().min(1).default(1),limit:o.Rx().int().min(1).max(100).default(20)}),r.Ry({sortBy:r.Z_().optional(),sortOrder:r.Km(["asc","desc"]).default("desc")}),(e,t)=>{try{return{success:!0,data:e.parse(t),errors:null}}catch(e){if(e instanceof i.j)return{success:!1,data:null,errors:(e.errors||[]).map(e=>({field:e.path?.join(".")||"unknown",message:e.message,code:e.code}))};return{success:!1,data:null,errors:[{message:"Validation failed",code:"unknown_error"}]}}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,766,482,254,258],()=>a(7078));module.exports=r})();