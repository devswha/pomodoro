"use strict";(()=>{var e={};e.id=707,e.ids=[707],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},3547:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>h,patchFetch:()=>O,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>S,staticGenerationAsyncStorage:()=>_});var r={};s.r(r),s.d(r,{GET:()=>m});var a=s(9303),o=s(8716),i=s(670),n=s(1595),l=s(2859),d=s(7258);async function u(e,t){if((0,l.P)(e,t,["GET"])){if(await new Promise((s,r)=>{(0,d.mk)(e,t,e=>{e?r(e):s()})}),!n.pR)return(0,l.y7)(t,"Database access not available",503);try{let s=e.userId,r=new Date,a=r.toISOString().split("T")[0],[o,i,d,u,m]=await Promise.all([n.pR.from(n.ji.USER_STATS).select("*").eq("user_id",s).single(),n.pR.from(n.ji.POMODORO_SESSIONS).select("*").eq("user_id",s).eq("status","active").single(),n.pR.from(n.ji.POMODORO_SESSIONS).select("*").eq("user_id",s).gte("start_time",`${a}T00:00:00`).lte("start_time",`${a}T23:59:59`).order("start_time",{ascending:!1}),n.pR.from(n.ji.MEETINGS).select("*").eq("user_id",s).gte("date",a).order("date",{ascending:!0}).order("time",{ascending:!0}).limit(5),(()=>{let e=new Date(r);e.setDate(r.getDate()-r.getDay());let t=e.toISOString().split("T")[0];return n.pR.from(n.ji.POMODORO_SESSIONS).select("*").eq("user_id",s).gte("start_time",`${t}T00:00:00`).lte("start_time",`${a}T23:59:59`)})()]),c=o.data||{total_sessions:0,completed_sessions:0,total_minutes:0,completed_minutes:0,streak_days:0,longest_streak:0,weekly_goal:140,completion_rate:0,average_session_length:0},g=i.data,_=d.data||[],S=u.data||[],h=m.data||[],O={totalSessions:_.length,completedSessions:_.filter(e=>"completed"===e.status).length,totalMinutes:_.reduce((e,t)=>e+(t.duration||0),0),completedMinutes:_.filter(e=>"completed"===e.status).reduce((e,t)=>e+(t.duration||0),0),completionRate:_.length>0?Math.round(_.filter(e=>"completed"===e.status).length/_.length*100):0},f={completedMinutes:h.filter(e=>"completed"===e.status).reduce((e,t)=>e+(t.duration||0),0),goal:c.weekly_goal||140,progressPercentage:0};f.progressPercentage=f.goal>0?Math.round(f.completedMinutes/f.goal*100):0;let w=S.map(e=>{let t=new Date(`${e.date}T${e.time}`),s=Math.round((t-r)/6e4);return s<0?null:{...e,minutesUntil:s,hoursUntil:Math.round(s/60),isToday:e.date===a,isSoon:s<=(e.reminder_minutes||15),timeUntilText:function(e){if(e<0)return"Past due";if(0===e)return"Now";if(e<60)return`${e} minute${1!==e?"s":""}`;let t=Math.floor(e/60),s=e%60;return 0===s?`${t} hour${1!==t?"s":""}`:`${t}h ${s}m`}(s)}}).filter(Boolean).slice(0,3),y=new Date(r.getTime()-6048e5),{data:M}=await n.pR.from(n.ji.POMODORO_SESSIONS).select("*").eq("user_id",s).gte("start_time",y.toISOString()).order("start_time",{ascending:!1}).limit(10),q={};(M||[]).forEach(e=>{let t=e.start_time.split("T")[0];q[t]||(q[t]={date:t,sessions:0,completed:0,minutes:0}),q[t].sessions++,q[t].minutes+=e.duration||0,"completed"===e.status&&q[t].completed++});let R=g;if(g){let e=new Date(g.end_time);if(r>=e){let{data:t}=await n.pR.from(n.ji.POMODORO_SESSIONS).update({status:"completed",completed_at:e.toISOString(),updated_at:r.toISOString()}).eq("id",g.id).select().single();R=t?{...t,autoCompleted:!0}:null,t&&await p(s,t)}}let v={user:{id:s},overview:{totalSessions:c.total_sessions,completedSessions:c.completed_sessions,totalMinutes:c.total_minutes,completedMinutes:c.completed_minutes,currentStreak:c.streak_days,longestStreak:c.longest_streak,overallCompletionRate:c.completion_rate,averageSessionLength:c.average_session_length},today:O,weekly:f,activeSession:R,upcomingMeetings:w,recentActivity:Object.values(q).sort((e,t)=>t.date.localeCompare(e.date)),goals:{weeklyGoal:c.weekly_goal,weeklyProgress:f.completedMinutes,weeklyProgressPercentage:f.progressPercentage,dailyTarget:Math.round(c.weekly_goal/7),todayProgress:O.completedMinutes}};return(0,l.Wr)(t,v)}catch(e){return console.error("Dashboard error:",e),(0,l.y7)(t,"Failed to load dashboard data",500)}}}async function p(e,t){try{let{data:s}=await n.pR.from(n.ji.USER_STATS).select("*").eq("user_id",e).single();if(s){let r={completed_sessions:s.completed_sessions+1,completed_minutes:s.completed_minutes+t.duration,updated_at:new Date().toISOString()};r.completion_rate=Math.round(r.completed_sessions/s.total_sessions*100),r.completed_sessions>0&&(r.average_session_length=Math.round(r.completed_minutes/r.completed_sessions)),await n.pR.from(n.ji.USER_STATS).update(r).eq("user_id",e)}}catch(e){console.error("Failed to update completion stats:",e)}}let m=(0,l.bi)(u),c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/dashboard/route",pathname:"/api/dashboard",filename:"route",bundlePath:"app/api/dashboard/route"},resolvedPagePath:"/home/devswha/workspace/pomodoro/app/api/dashboard/route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:_,serverHooks:S}=c,h="/api/dashboard/route";function O(){return(0,i.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:_})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,766,482,258],()=>s(3547));module.exports=r})();