"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},8497:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p});var n={};r.r(n),r.d(n,{POST:()=>d});var a=r(9303),i=r(8716),o=r(670),s=r(1595),l=r(7246),u=r(2859);let d=async function(e){let t=await e.json(),r=(0,l.Fv)(l.dm,t);if(!r.success)return(0,u.Gc)(null,r.errors);let{username:n,password:a,rememberMe:i}=r.data;try{let e=n;if(!n.includes("@")){if(!s.pR)return(0,u.LW)(null,"Username login requires database access");{let{data:t,error:r}=await s.pR.from(s.ji.USERS).select("email").eq("username",n.toLowerCase()).single();if(r||!t)return(0,u.LW)(null,"Invalid username or password");e=t.email}}let{data:t,error:r}=await s.OQ.auth.signInWithPassword({email:e,password:a});if(r){if(r.message.includes("Invalid login credentials"))return(0,u.LW)(null,"Invalid username or password");if(r.message.includes("Email not confirmed"))return(0,u.LW)(null,"Please verify your email address before logging in");return(0,u.y7)(null,r.message,400)}let i=t.user,o=t.session;if(!i||!o)return(0,u.LW)(null,"Authentication failed");s.pR&&await s.pR.from(s.ji.USERS).update({last_login_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",i.id);let l=null;if(s.pR){let{data:e}=await s.pR.from(s.ji.USERS).select(`
          id,
          username,
          display_name,
          email,
          avatar_url,
          bio,
          role,
          created_at,
          last_login_at
        `).eq("id",i.id).single();l=e}let d=null;if(s.pR){let{data:e}=await s.pR.from(s.ji.USER_PREFERENCES).select("*").eq("user_id",i.id).single();d=e}let m={user:{id:i.id,email:i.email,username:l?.username||n.toLowerCase(),displayName:l?.display_name||i.user_metadata?.display_name||n,avatarUrl:l?.avatar_url||i.user_metadata?.avatar_url,bio:l?.bio,role:l?.role||"user",emailConfirmed:!!i.email_confirmed_at,createdAt:i.created_at,lastLoginAt:l?.last_login_at},session:{accessToken:o.access_token,refreshToken:o.refresh_token,expiresIn:o.expires_in,expiresAt:o.expires_at,tokenType:o.token_type},preferences:d,message:"Login successful"};return(0,u.Wr)(null,m,"Login successful")}catch(e){return console.error("Login error:",e),(0,u.y7)(null,"Login failed",500)}},m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/home/devswha/workspace/pomodoro/app/api/auth/login/route.js",nextConfigOutput:"",userland:n}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:f}=m,h="/api/auth/login/route";function g(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:p})}},1595:(e,t,r)=>{r.d(t,{OQ:()=>d,ji:()=>c,pR:()=>m});var n=r(9498);let a="https://demo.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlbW8iLCJyb2xlIjoiYW5vbiIsImlhdCI6MTY0NjkyODAwMCwiZXhwIjoxOTYyNTA0MDAwfQ.demo-key-for-local-development",o=process.env.SUPABASE_SERVICE_ROLE_KEY,s=e=>{if(!e||e.includes("your_supabase")||e.includes("placeholder")||e.includes("demo.supabase.co"))return!1;try{return new URL(e),e.includes("supabase.co")}catch{return!1}},l=s(a)&&i&&!i.includes("your_");console.log("Supabase Configuration Status:",{url:a?"Present":"Missing",urlValid:s(a),anonKey:i?"Present":"Missing",anonKeyValid:i&&!i.includes("your_"),hasValidConfig:l});let u=()=>{let e={select:function(){return this},insert:function(){return this},update:function(){return this},delete:function(){return this},eq:function(){return this},neq:function(){return this},gt:function(){return this},gte:function(){return this},lt:function(){return this},lte:function(){return this},like:function(){return this},ilike:function(){return this},is:function(){return this},in:function(){return this},contains:function(){return this},containedBy:function(){return this},rangeGt:function(){return this},rangeGte:function(){return this},rangeLt:function(){return this},rangeLte:function(){return this},rangeAdjacent:function(){return this},overlaps:function(){return this},textSearch:function(){return this},match:function(){return this},not:function(){return this},or:function(){return this},filter:function(){return this},order:function(){return this},limit:function(){return this},range:function(){return this},abortSignal:function(){return this},single:function(){return Promise.resolve({data:null,error:{message:"Using localStorage mode - no data available"}})},maybeSingle:function(){return Promise.resolve({data:null,error:null})},then:function(e){return e({data:[],error:null})},catch:function(){return this}};return{from:()=>e,auth:{signUp:()=>Promise.resolve({data:{user:null,session:null},error:{message:"Using localStorage mode"}}),signInWithPassword:()=>Promise.resolve({data:{user:null,session:null},error:{message:"Using localStorage mode"}}),signOut:()=>Promise.resolve({error:null}),getUser:()=>Promise.resolve({data:{user:null},error:{message:"Using localStorage mode"}}),getSession:()=>Promise.resolve({data:{session:null},error:null}),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}})},channel:()=>({on:function(){return this},subscribe:()=>Promise.resolve("SUBSCRIBED"),unsubscribe:()=>{},track:()=>Promise.resolve(),send:()=>Promise.resolve(),presenceState:()=>({})}),realtime:{disconnect:()=>{}}}},d=l?(0,n.eI)(a,i,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:void 0},realtime:{params:{eventsPerSecond:10}}}):u(),m=l&&o?(0,n.eI)(a,o,{auth:{autoRefreshToken:!1,persistSession:!1}}):u(),c={USERS:"users",USER_PREFERENCES:"user_preferences",USER_STATS:"user_stats",POMODORO_SESSIONS:"pomodoro_sessions",MEETINGS:"meetings",AUTH_SESSIONS:"auth_sessions"}},2859:(e,t,r)=>{r.d(t,{Gc:()=>f,Hm:()=>m,Ij:()=>c,LW:()=>d,P:()=>_,Wr:()=>l,Xs:()=>p,bi:()=>g,kv:()=>R,y7:()=>u});let n=(e,t=null,r=null,n={})=>{let a={success:e,timestamp:new Date().toISOString(),...n};return e?(a.data=t,r&&(a.message=r)):(a.error=r||"An error occurred",t&&(a.details=t)),a},a=(e,t=null,r={})=>n(!0,e,t,r),i=(e,t=null,r={})=>n(!1,t,e,r),o={OK:200,UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,CONFLICT:409,UNPROCESSABLE_ENTITY:422,INTERNAL_SERVER_ERROR:500},s=(e,t,r)=>Response.json(r,{status:t}),l=(e,t,r=null,n=o.OK,i={})=>s(e,n,a(t,r,i)),u=(e,t,r=o.INTERNAL_SERVER_ERROR,n=null,a={})=>s(e,r,i(t,n,a)),d=(e,t="Unauthorized")=>u(e,t,o.UNAUTHORIZED),m=(e,t="Forbidden")=>u(e,t,o.FORBIDDEN),c=(e,t="Resource not found")=>u(e,t,o.NOT_FOUND),p=(e,t="Resource conflict",r=null)=>u(e,t,o.CONFLICT,r),f=(e,t,r="Validation failed")=>u(e,r,o.UNPROCESSABLE_ENTITY,t),h=(e,t="Internal server error",r=null)=>(r&&console.error("Internal server error:",r),u(e,t,o.INTERNAL_SERVER_ERROR)),g=e=>async(t,r)=>{try{await e(t,r)}catch(e){if(console.error("API route error:",e),"ValidationError"===e.name)return f(r,e.errors,e.message);if("UnauthorizedError"===e.name)return d(r,e.message);if("ForbiddenError"===e.name)return m(r,e.message);if("NotFoundError"===e.name)return c(r,e.message);if("ConflictError"===e.name)return p(r,e.message,e.details);return h(r,"An unexpected error occurred",e)}},R=(e,t,r)=>{let n=Math.ceil(r/t);return{pagination:{currentPage:e,totalPages:n,totalCount:r,limit:t,hasNextPage:e<n,hasPrevPage:e>1}}},_=(e,t,r)=>!!r.includes(e.method)||(t.setHeader("Allow",r.join(", ")),u(t,`Method ${e.method} not allowed`,405))},7246:(e,t,r)=>{r.d(t,{$p:()=>_,CG:()=>S,Db:()=>h,Fv:()=>E,Mk:()=>f,Vp:()=>c,W0:()=>y,bd:()=>R,dm:()=>m,g2:()=>x,gY:()=>d,sQ:()=>g,xH:()=>p});var n=r(1598),a=r(7254),i=r(9489);let o=n.Z_().email("Invalid email address").toLowerCase(),s=n.Z_().min(4,"Password must be at least 4 characters"),l=n.Z_().min(1,"Username is required").max(50,"Username too long");n.Z_().uuid("Invalid UUID format"),n.Rx().int().positive();let u=n.Z_().datetime("Invalid date format"),d=n.Ry({username:l,email:o,password:s,displayName:n.Z_().max(100).optional()}),m=n.Ry({username:l,password:n.Z_().min(1,"Password is required"),rememberMe:n.O7().default(!1)}),c=(n.Ry({currentPassword:n.Z_().min(1,"Current password is required"),newPassword:s}),n.Ry({displayName:n.Z_().max(100).optional(),email:o.optional(),bio:n.Z_().max(500).optional(),avatar:n.Z_().url().optional().or(n.i0(""))})),p=n.Ry({defaultPomodoroLength:n.Rx().int().min(1).max(120).default(25),breakLength:n.Rx().int().min(1).max(30).default(5),longBreakLength:n.Rx().int().min(1).max(60).default(15),weeklyGoal:n.Rx().int().min(1).max(1e3).default(140),theme:n.Km(["default","dark","minimal"]).default("default"),soundEnabled:n.O7().default(!0),notificationsEnabled:n.O7().default(!0),autoStartBreak:n.O7().default(!1),autoStartPomodoro:n.O7().default(!1)}),f=n.Ry({title:n.Z_().min(1,"Session title is required").max(200),goal:n.Z_().max(500).optional(),tags:n.Z_().max(200).optional(),location:n.Z_().max(100).optional(),duration:n.Rx().int().min(1).max(120).default(25),scheduledTime:u.optional()}),h=n.Ry({title:n.Z_().min(1).max(200).optional(),goal:n.Z_().max(500).optional(),tags:n.Z_().max(200).optional(),location:n.Z_().max(100).optional(),status:n.Km(["scheduled","active","completed","stopped"]).optional()}),g=n.Ry({page:a.Rx().int().min(1).default(1),limit:a.Rx().int().min(1).max(100).default(20),status:n.Km(["scheduled","active","completed","stopped"]).optional(),startDate:n.Z_().date().optional(),endDate:n.Z_().date().optional(),tags:n.Z_().optional()}),R=n.Ry({title:n.Z_().min(1,"Meeting title is required").max(200),description:n.Z_().max(1e3).optional(),date:n.Z_().date("Invalid date format"),time:n.Z_().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format (HH:MM)"),duration:n.Rx().int().min(15).max(480).default(60),location:n.Z_().max(200).optional(),participants:n.IX(n.Z_().email()).optional(),type:n.Km(["meeting","call","presentation","workshop","other"]).default("meeting"),priority:n.Km(["low","medium","high"]).default("medium"),reminderMinutes:n.Rx().int().min(0).max(10080).default(15)}),_=R.partial(),S=n.Ry({date:n.Z_().date().optional(),startDate:n.Z_().date().optional(),endDate:n.Z_().date().optional(),type:n.Km(["meeting","call","presentation","workshop","other"]).optional(),priority:n.Km(["low","medium","high"]).optional()}),x=n.Ry({period:n.Km(["day","week","month","year"]).default("week"),startDate:n.Z_().date().optional(),endDate:n.Z_().date().optional()}),y=n.Ry({period:n.Km(["week","month","year"]).default("week"),limit:a.Rx().int().min(1).max(100).default(10)}),E=(n.Ry({page:a.Rx().int().min(1).default(1),limit:a.Rx().int().min(1).max(100).default(20)}),n.Ry({sortBy:n.Z_().optional(),sortOrder:n.Km(["asc","desc"]).default("desc")}),(e,t)=>{try{return{success:!0,data:e.parse(t),errors:null}}catch(e){if(e instanceof i.j)return{success:!1,data:null,errors:(e.errors||[]).map(e=>({field:e.path?.join(".")||"unknown",message:e.message,code:e.code}))};return{success:!1,data:null,errors:[{message:"Validation failed",code:"unknown_error"}]}}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,766,254],()=>r(8497));module.exports=n})();