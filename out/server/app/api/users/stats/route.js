"use strict";(()=>{var e={};e.id=150,e.ids=[150],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},1104:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>y,staticGenerationAsyncStorage:()=>x});var o={};a.r(o),a.d(o,{GET:()=>p});var s=a(9303),i=a(8716),r=a(670),n=a(1595),l=a(7246),d=a(2859),u=a(7258);async function m(e,t){if(!(0,d.P)(e,t,["GET"]))return;if(await new Promise((a,o)=>{(0,u.mk)(e,t,e=>{e?o(e):a()})}),!n.pR)return(0,d.y7)(t,"Database access not available",503);let a=(0,l.Fv)(l.g2,e.query||{});if(!a.success)return(0,d.Gc)(t,a.errors);try{let o=e.userId,{period:s,startDate:i,endDate:r}=a.data,{data:l,error:u}=await n.pR.from(n.ji.USER_STATS).select("*").eq("user_id",o).single();if(u)return console.error("Failed to get user stats:",u),(0,d.y7)(t,"Failed to retrieve statistics",500);let m={},p=new Date;if(i&&r)m={start:i,end:r};else switch(s){case"day":let c=p.toISOString().split("T")[0];m={start:c,end:c};break;case"week":let g=new Date(p);g.setDate(p.getDate()-p.getDay());let x=new Date(g);x.setDate(g.getDate()+6),m={start:g.toISOString().split("T")[0],end:x.toISOString().split("T")[0]};break;case"month":let y=new Date(p.getFullYear(),p.getMonth(),1),f=new Date(p.getFullYear(),p.getMonth()+1,0);m={start:y.toISOString().split("T")[0],end:f.toISOString().split("T")[0]};break;case"year":let h=new Date(p.getFullYear(),0,1),_=new Date(p.getFullYear(),11,31);m={start:h.toISOString().split("T")[0],end:_.toISOString().split("T")[0]}}let{data:w,error:S}=await n.pR.from(n.ji.POMODORO_SESSIONS).select("*").eq("user_id",o).gte("start_time",`${m.start}T00:00:00`).lte("start_time",`${m.end}T23:59:59`).order("start_time",{ascending:!1});if(S)return console.error("Failed to get sessions:",S),(0,d.y7)(t,"Failed to retrieve session data",500);let R={totalSessions:w.length,completedSessions:w.filter(e=>"completed"===e.status).length,totalMinutes:w.reduce((e,t)=>e+(t.duration||0),0),completedMinutes:w.filter(e=>"completed"===e.status).reduce((e,t)=>e+(t.duration||0),0),averageSessionLength:0,completionRate:0,sessionsByDay:{},tagStats:{},locationStats:{}};R.totalSessions>0&&(R.completionRate=Math.round(R.completedSessions/R.totalSessions*100)),R.completedSessions>0&&(R.averageSessionLength=Math.round(R.completedMinutes/R.completedSessions)),w.forEach(e=>{let t=e.start_time.split("T")[0];R.sessionsByDay[t]||(R.sessionsByDay[t]={total:0,completed:0,minutes:0}),R.sessionsByDay[t].total++,R.sessionsByDay[t].minutes+=e.duration||0,"completed"===e.status&&R.sessionsByDay[t].completed++}),w.forEach(e=>{e.tags&&e.tags.split(",").map(e=>e.trim()).filter(Boolean).forEach(t=>{R.tagStats[t]||(R.tagStats[t]={count:0,minutes:0}),R.tagStats[t].count++,"completed"===e.status&&(R.tagStats[t].minutes+=e.duration||0)})}),w.forEach(e=>{e.location&&(R.locationStats[e.location]||(R.locationStats[e.location]={count:0,minutes:0}),R.locationStats[e.location].count++,"completed"===e.status&&(R.locationStats[e.location].minutes+=e.duration||0))});let Z={overall:l,period:{...R,dateRange:m,period:s},goals:{weeklyGoal:l.weekly_goal||140,weeklyProgress:"week"===s?R.completedMinutes:0,weeklyProgressPercentage:"week"===s&&l.weekly_goal?Math.round(R.completedMinutes/l.weekly_goal*100):0}};return(0,d.Wr)(t,Z)}catch(e){return console.error("Get stats error:",e),(0,d.y7)(t,"Failed to retrieve statistics",500)}}let p=(0,d.bi)(m),c=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/users/stats/route",pathname:"/api/users/stats",filename:"route",bundlePath:"app/api/users/stats/route"},resolvedPagePath:"/home/devswha/workspace/pomodoro/app/api/users/stats/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:y}=c,f="/api/users/stats/route";function h(){return(0,r.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:x})}},7246:(e,t,a)=>{a.d(t,{$p:()=>h,CG:()=>_,Db:()=>x,Fv:()=>R,Mk:()=>g,Vp:()=>p,W0:()=>S,bd:()=>f,dm:()=>m,g2:()=>w,gY:()=>u,sQ:()=>y,xH:()=>c});var o=a(1598),s=a(7254),i=a(9489);let r=o.Z_().email("Invalid email address").toLowerCase(),n=o.Z_().min(4,"Password must be at least 4 characters"),l=o.Z_().min(1,"Username is required").max(50,"Username too long");o.Z_().uuid("Invalid UUID format"),o.Rx().int().positive();let d=o.Z_().datetime("Invalid date format"),u=o.Ry({username:l,email:r,password:n,displayName:o.Z_().max(100).optional()}),m=o.Ry({username:l,password:o.Z_().min(1,"Password is required"),rememberMe:o.O7().default(!1)}),p=(o.Ry({currentPassword:o.Z_().min(1,"Current password is required"),newPassword:n}),o.Ry({displayName:o.Z_().max(100).optional(),email:r.optional(),bio:o.Z_().max(500).optional(),avatar:o.Z_().url().optional().or(o.i0(""))})),c=o.Ry({defaultPomodoroLength:o.Rx().int().min(1).max(120).default(25),breakLength:o.Rx().int().min(1).max(30).default(5),longBreakLength:o.Rx().int().min(1).max(60).default(15),weeklyGoal:o.Rx().int().min(1).max(1e3).default(140),theme:o.Km(["default","dark","minimal"]).default("default"),soundEnabled:o.O7().default(!0),notificationsEnabled:o.O7().default(!0),autoStartBreak:o.O7().default(!1),autoStartPomodoro:o.O7().default(!1)}),g=o.Ry({title:o.Z_().min(1,"Session title is required").max(200),goal:o.Z_().max(500).optional(),tags:o.Z_().max(200).optional(),location:o.Z_().max(100).optional(),duration:o.Rx().int().min(1).max(120).default(25),scheduledTime:d.optional()}),x=o.Ry({title:o.Z_().min(1).max(200).optional(),goal:o.Z_().max(500).optional(),tags:o.Z_().max(200).optional(),location:o.Z_().max(100).optional(),status:o.Km(["scheduled","active","completed","stopped"]).optional()}),y=o.Ry({page:s.Rx().int().min(1).default(1),limit:s.Rx().int().min(1).max(100).default(20),status:o.Km(["scheduled","active","completed","stopped"]).optional(),startDate:o.Z_().date().optional(),endDate:o.Z_().date().optional(),tags:o.Z_().optional()}),f=o.Ry({title:o.Z_().min(1,"Meeting title is required").max(200),description:o.Z_().max(1e3).optional(),date:o.Z_().date("Invalid date format"),time:o.Z_().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format (HH:MM)"),duration:o.Rx().int().min(15).max(480).default(60),location:o.Z_().max(200).optional(),participants:o.IX(o.Z_().email()).optional(),type:o.Km(["meeting","call","presentation","workshop","other"]).default("meeting"),priority:o.Km(["low","medium","high"]).default("medium"),reminderMinutes:o.Rx().int().min(0).max(10080).default(15)}),h=f.partial(),_=o.Ry({date:o.Z_().date().optional(),startDate:o.Z_().date().optional(),endDate:o.Z_().date().optional(),type:o.Km(["meeting","call","presentation","workshop","other"]).optional(),priority:o.Km(["low","medium","high"]).optional()}),w=o.Ry({period:o.Km(["day","week","month","year"]).default("week"),startDate:o.Z_().date().optional(),endDate:o.Z_().date().optional()}),S=o.Ry({period:o.Km(["week","month","year"]).default("week"),limit:s.Rx().int().min(1).max(100).default(10)}),R=(o.Ry({page:s.Rx().int().min(1).default(1),limit:s.Rx().int().min(1).max(100).default(20)}),o.Ry({sortBy:o.Z_().optional(),sortOrder:o.Km(["asc","desc"]).default("desc")}),(e,t)=>{try{return{success:!0,data:e.parse(t),errors:null}}catch(e){if(e instanceof i.j)return{success:!1,data:null,errors:(e.errors||[]).map(e=>({field:e.path?.join(".")||"unknown",message:e.message,code:e.code}))};return{success:!1,data:null,errors:[{message:"Validation failed",code:"unknown_error"}]}}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[948,766,482,254,258],()=>a(1104));module.exports=o})();