"use strict";(()=>{var e={};e.id=367,e.ids=[367],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},5501:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>y,patchFetch:()=>h,requestAsyncStorage:()=>x,routeModule:()=>_,serverHooks:()=>g,staticGenerationAsyncStorage:()=>R});var r={};a.r(r),a.d(r,{GET:()=>c,PUT:()=>f});var i=a(9303),o=a(8716),n=a(670),s=a(1595),l=a(7246),d=a(2859),u=a(7258);async function p(e,t){if(await new Promise((a,r)=>{(0,u.mk)(e,t,e=>{e?r(e):a()})}),!s.pR)return(0,d.y7)(t,"Database access not available",503);try{let a=e.userId,{data:r,error:i}=await s.pR.from(s.ji.USER_PREFERENCES).select("*").eq("user_id",a).single();if(i||!r){let e={user_id:a,default_pomodoro_length:25,break_length:5,long_break_length:15,weekly_goal:140,theme:"default",sound_enabled:!0,notifications_enabled:!0,auto_start_break:!1,auto_start_pomodoro:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:r,error:i}=await s.pR.from(s.ji.USER_PREFERENCES).insert(e).select().single();if(i)return console.error("Failed to create default preferences:",i),(0,d.y7)(t,"Failed to retrieve preferences",500);return(0,d.Wr)(t,r)}return(0,d.Wr)(t,r)}catch(e){return console.error("Get preferences error:",e),(0,d.y7)(t,"Failed to retrieve preferences",500)}}async function m(e,t){if(await new Promise((a,r)=>{(0,u.mk)(e,t,e=>{e?r(e):a()})}),!s.pR)return(0,d.y7)(t,"Database access not available",503);let a=(0,l.Fv)(l.xH,e.body);if(!a.success)return(0,d.Gc)(t,a.errors);try{let r;let i=e.userId,o=a.data,{data:n,error:l}=await s.pR.from(s.ji.USER_PREFERENCES).select("id").eq("user_id",i).single();if(l&&"PGRST116"!==l.code)return console.error("Error checking existing preferences:",l),(0,d.y7)(t,"Failed to check existing preferences",500);if(n){let{data:e,error:a}=await s.pR.from(s.ji.USER_PREFERENCES).update({...o,updated_at:new Date().toISOString()}).eq("user_id",i).select().single();if(a)return console.error("Failed to update preferences:",a),(0,d.y7)(t,"Failed to update preferences",500);r=e}else{let e={user_id:i,...o,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:a,error:n}=await s.pR.from(s.ji.USER_PREFERENCES).insert(e).select().single();if(n)return console.error("Failed to create preferences:",n),(0,d.y7)(t,"Failed to create preferences",500);r=a}return(0,d.Wr)(t,r,"Preferences updated successfully")}catch(e){return console.error("Update preferences error:",e),(0,d.y7)(t,"Failed to update preferences",500)}}let c=(0,d.bi)(p),f=(0,d.bi)(m),_=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/users/preferences/route",pathname:"/api/users/preferences",filename:"route",bundlePath:"app/api/users/preferences/route"},resolvedPagePath:"/home/devswha/workspace/pomodoro/app/api/users/preferences/route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:x,staticGenerationAsyncStorage:R,serverHooks:g}=_,y="/api/users/preferences/route";function h(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:R})}},7246:(e,t,a)=>{a.d(t,{$p:()=>g,CG:()=>y,Db:()=>_,Fv:()=>Z,Mk:()=>f,Vp:()=>m,W0:()=>w,bd:()=>R,dm:()=>p,g2:()=>h,gY:()=>u,sQ:()=>x,xH:()=>c});var r=a(1598),i=a(7254),o=a(9489);let n=r.Z_().email("Invalid email address").toLowerCase(),s=r.Z_().min(4,"Password must be at least 4 characters"),l=r.Z_().min(1,"Username is required").max(50,"Username too long");r.Z_().uuid("Invalid UUID format"),r.Rx().int().positive();let d=r.Z_().datetime("Invalid date format"),u=r.Ry({username:l,email:n,password:s,displayName:r.Z_().max(100).optional()}),p=r.Ry({username:l,password:r.Z_().min(1,"Password is required"),rememberMe:r.O7().default(!1)}),m=(r.Ry({currentPassword:r.Z_().min(1,"Current password is required"),newPassword:s}),r.Ry({displayName:r.Z_().max(100).optional(),email:n.optional(),bio:r.Z_().max(500).optional(),avatar:r.Z_().url().optional().or(r.i0(""))})),c=r.Ry({defaultPomodoroLength:r.Rx().int().min(1).max(120).default(25),breakLength:r.Rx().int().min(1).max(30).default(5),longBreakLength:r.Rx().int().min(1).max(60).default(15),weeklyGoal:r.Rx().int().min(1).max(1e3).default(140),theme:r.Km(["default","dark","minimal"]).default("default"),soundEnabled:r.O7().default(!0),notificationsEnabled:r.O7().default(!0),autoStartBreak:r.O7().default(!1),autoStartPomodoro:r.O7().default(!1)}),f=r.Ry({title:r.Z_().min(1,"Session title is required").max(200),goal:r.Z_().max(500).optional(),tags:r.Z_().max(200).optional(),location:r.Z_().max(100).optional(),duration:r.Rx().int().min(1).max(120).default(25),scheduledTime:d.optional()}),_=r.Ry({title:r.Z_().min(1).max(200).optional(),goal:r.Z_().max(500).optional(),tags:r.Z_().max(200).optional(),location:r.Z_().max(100).optional(),status:r.Km(["scheduled","active","completed","stopped"]).optional()}),x=r.Ry({page:i.Rx().int().min(1).default(1),limit:i.Rx().int().min(1).max(100).default(20),status:r.Km(["scheduled","active","completed","stopped"]).optional(),startDate:r.Z_().date().optional(),endDate:r.Z_().date().optional(),tags:r.Z_().optional()}),R=r.Ry({title:r.Z_().min(1,"Meeting title is required").max(200),description:r.Z_().max(1e3).optional(),date:r.Z_().date("Invalid date format"),time:r.Z_().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format (HH:MM)"),duration:r.Rx().int().min(15).max(480).default(60),location:r.Z_().max(200).optional(),participants:r.IX(r.Z_().email()).optional(),type:r.Km(["meeting","call","presentation","workshop","other"]).default("meeting"),priority:r.Km(["low","medium","high"]).default("medium"),reminderMinutes:r.Rx().int().min(0).max(10080).default(15)}),g=R.partial(),y=r.Ry({date:r.Z_().date().optional(),startDate:r.Z_().date().optional(),endDate:r.Z_().date().optional(),type:r.Km(["meeting","call","presentation","workshop","other"]).optional(),priority:r.Km(["low","medium","high"]).optional()}),h=r.Ry({period:r.Km(["day","week","month","year"]).default("week"),startDate:r.Z_().date().optional(),endDate:r.Z_().date().optional()}),w=r.Ry({period:r.Km(["week","month","year"]).default("week"),limit:i.Rx().int().min(1).max(100).default(10)}),Z=(r.Ry({page:i.Rx().int().min(1).default(1),limit:i.Rx().int().min(1).max(100).default(20)}),r.Ry({sortBy:r.Z_().optional(),sortOrder:r.Km(["asc","desc"]).default("desc")}),(e,t)=>{try{return{success:!0,data:e.parse(t),errors:null}}catch(e){if(e instanceof o.j)return{success:!1,data:null,errors:(e.errors||[]).map(e=>({field:e.path?.join(".")||"unknown",message:e.message,code:e.code}))};return{success:!1,data:null,errors:[{message:"Validation failed",code:"unknown_error"}]}}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,766,482,254,258],()=>a(5501));module.exports=r})();